{% extends "ErpProject/ModuleComptabilite/shared/layout.html" %}
    {% block page %}
        {%load static %}
        {% load account_filters %}
        <style type="text/css">
            td
            {mso-style-parent:style0;
            padding:0px;
            mso-ignore:padding;
            color:black;
            font-size:11.0pt;
            font-weight:400;
            font-style:normal;
            text-decoration:none;
            font-family:Calibri, sans-serif;
            mso-font-charset:0;
            mso-number-format:General;
            text-align:general;
            vertical-align:bottom;
            border:none;
            mso-background-source:auto;
            mso-pattern:auto;
            mso-protection:locked visible;
            white-space:nowrap;
            mso-rotate:0;}
            tr {mso-height-source:auto;}
            col{mso-width-source:auto;}
            br{mso-data-placement:same-cell;}
        </style>
        <div class="row">
            <ul class="breadcrumb">
                <li><a href="{% url 'backoffice_index' %}"><span class="mif-home"></span></a></li>
                <li><a class="chargement-au-click" href="{% url 'module_comptabilite_tableau_de_bord' %}">Module Comptabilité</a></li>
                <li>{{ title }}</li>
            </ul>
        </div>
        <div class="row">
            <button onclick="javascript:document.getElementById('submit').click()" class="theme-btn theme-btn-sm rounded primary_color_{{module.name|lower}} chargement-au-click">Imprimer</button>
            <button id="btn_export" class="theme-btn theme-btn-sm rounded chargement-au-click">Exporter en Excel</button>
        </div>
        <form id="form" method="POST" action="{% url 'module_comptabilite_post_imprimer_annexe' %}">
            {% csrf_token %}
            <input id="submit" type="submit" style="display: none">
            <input type="text" name="date_debut" value="{{ date_debut }}" style="display: none">
            <input type="text" name="date_fin" value="{{ date_fin }}" style="display: none">
            <input type="number" name="devise_id" value="{{ devise.id }}" style="display: none">
        </form>
        <hr class="hr-ligne">
        <div id="divToPrint" class="row item-content" style="margin-top: 20px" style="padding-top: 30px">
            <p class="align-center header">{{ title }}</p>
            <div class="row">
                <p>
                    Période :<br>
                    <span class="sub-header">Du {{ date_debut }} au {{ date_fin }} </span>
                    <br>
                    <br>
                    Devise :<br>
                    <span class="sub-header">{{ devise.designation }}</span>
                </p>
            </div>
            <br>
            <div class="row" style="margin: auto!important;">
                <table id="rapport" class="table bordered no-margin" style="width: 800px;font-size:12px!important;">
                    <tr style="background-color:#91a7c3;color:#fff;font-weight:500">
                        <td align="center"> NOTES </td>
                        <td align="center"> INTITULES </td>
                    </tr>
                    <tr>
                        <td style="background-color:#7c984a;color:#fff;font-weight:500"align="center">
                          <a href="{% url 'module_comptabilite_list_note_cas_1' %}" target="_blank">NOTE 1</a>
                        </td>
                        <td style="background-color:#f1f1f1;color:#000;font-weight:500"align="center">
                            DETTES GARANTIES PAR DES SURETES REELLES
                        </td>
                    </tr>
                    <tr>
                        <td style="background-color:#7c984a;color:#fff;font-weight:500"align="center">
                            <a href="{% url 'module_comptabilite_list_note_cas_2' %}" target="_blank">NOTE 2 </a>
                        </td>
                        <td style="background-color:#f1f1f1;color:#000;font-weight:500"align="center">INFORMATIONS OBLIGATOIRES </td>
                    </tr>
                    <tr>
                        <td style="background-color:#7c984a;color:#fff;font-weight:500"align="center">
                            <a href="{% url 'module_comptabilite_list_note_cas_3' %}" target="_blank">NOTE 3A </a>
                        </td>
                        <td style="background-color:#f1f1f1;color:#000;font-weight:500"align="center">IMMOBILISATION BRUTE </td>
                    </tr>
                    <tr>
                        <td style="background-color:#7c984a;color:#fff;font-weight:500"align="center">
                            <a href="{% url 'module_comptabilite_list_note_cas_3B' %}" target="_blank">NOTE 3B </a>
                        </td>
                        <td style="background-color:#f1f1f1;color:#000;font-weight:500"align="center">BIENS PRIS EN LOCATION ACQUISITION </td>
                    </tr>

                    <tr>
                        <td style="background-color:#7c984a;color:#fff;font-weight:500"align="center">
                            <a href="{% url 'module_comptabilite_list_note_cas_3C' %}" target="_blank">NOTE 3C</a>
                        </td>
                        <td style="background-color:#f1f1f1;color:#000;font-weight:500"align="center">IMMOBILISATIONS : AMORTISSEMENTS</td>
                    </tr>
                    <tr>
                        <td style="background-color:#7c984a;color:#fff;font-weight:500"align="center">
                            <a href="{% url 'module_comptabilite_list_note_cas_3D' %}" target="_blank">NOTE 3D</a>
                        </td>
                        <td style="background-color:#f1f1f1;color:#000;font-weight:500"align="center">IMMOBILISATIONS : PLUS-VALUES ET MOINS VALUE DE CESSION </td>
                    </tr>
                    <tr>
                        <td style="background-color:#7c984a;color:#fff;font-weight:500"align="center">
                            <a href="{% url 'module_comptabilite_list_note_cas_3E' %}" target="_blank">NOTE 3E</a>
                        </td>
                        <td style="background-color:#f1f1f1;color:#000;font-weight:500"align="center">INFORMATIONS SUR LES REEVALUATIONS EFFECTUEES PAR L'ENTITE </td>
                    </tr>
                    <tr>
                        <td style="background-color:#7c984a;color:#fff;font-weight:500"align="center">
                            NOTE 3F
                        </td>
                        <td style="background-color:#f1f1f1;color:#000;font-weight:500"align="center">TABLEAU D’ETALEMENT DES CHARGES IMMOBILISEES </td>
                    </tr>
                    <tr>
                        <td style="background-color:#7c984a;color:#fff;font-weight:500"align="center">
                            <a href="{% url 'module_comptabilite_list_note_cas_4' %}" target="_blank">NOTE 4</a>
                        </td>
                        <td style="background-color:#f1f1f1;color:#000;font-weight:500"align="center">IMMOBILISATIONS FINANCIERES </td>
                    </tr>
                    <tr>
                        <td style="background-color:#7c984a;color:#fff;font-weight:500"align="center">
                            <a href="{% url 'module_comptabilite_list_note_cas_5' %}" target="_blank">NOTE 5</a>
                        </td>
                        <td style="background-color:#f1f1f1;color:#000;font-weight:500"align="center">ACTIF CIRCULANT HAO </td>
                    </tr>
                    <tr>
                        <td style="background-color:#7c984a;color:#fff;font-weight:500"align="center">
                            <a href="{% url 'module_comptabilite_list_note_cas_6' %}" target="_blank">NOTE 6</a>
                        </td>
                        <td style="background-color:#f1f1f1;color:#000;font-weight:500"align="center">STOCKS ET ENCOURS </td>
                    </tr>
                    <tr>
                        <td style="background-color:#7c984a;color:#fff;font-weight:500"align="center">
                            <a href="{% url 'module_comptabilite_list_note_cas_7' %}" target="_blank">NOTE 7</a>
                        </td>
                        <td style="background-color:#f1f1f1;color:#000;font-weight:500"align="center">CLIENTS PRODUITS A RECEVOIR </td>
                    </tr>
                    <tr>
                        <td style="background-color:#7c984a;color:#fff;font-weight:500"align="center">
                            <a href="{% url 'module_comptabilite_list_note_cas_8' %}" target="_blank">NOTE 8</a></td>
                        <td style="background-color:#f1f1f1;color:#000;font-weight:500"align="center"> AUTRES CREANCES </td>
                    </tr>
                    <tr>
                        <td style="background-color:#7c984a;color:#fff;font-weight:500"align="center">
                            <a href="{% url 'module_comptabilite_list_note_cas_9' %}" target="_blank">NOTE 9</a></td>
                        <td style="background-color:#f1f1f1;color:#000;font-weight:500"align="center"> TITRES DE PLACEMENT </td>
                    </tr>
                    <tr>
                        <td style="background-color:#7c984a;color:#fff;font-weight:500"align="center">
                            <a href="{% url 'module_comptabilite_list_note_cas_10' %}" target="_blank">NOTE 10</a></td>
                        <td style="background-color:#f1f1f1;color:#000;font-weight:500"align="center">VALEURS A ENCAISSER </td>
                    </tr>
                    <tr>
                        <td style="background-color:#7c984a;color:#fff;font-weight:500"align="center">
                            <a href="{% url 'module_comptabilite_list_note_cas_11' %}" target="_blank">NOTE 11</a></td>
                        <td style="background-color:#f1f1f1;color:#000;font-weight:500"align="center">DISPONIBILITES </td>
                    </tr>

                    <tr>
                        <td style="background-color:#7c984a;color:#fff;font-weight:500"align="center">
                            <a href="{% url 'module_comptabilite_list_note_cas_12' %}" target="_blank">NOTE 12</a></td>
                        <td style="background-color:#f1f1f1;color:#000;font-weight:500"align="center">ECARTS DE CONVERSION </td>
                    </tr>
                    <tr>
                        <td style="background-color:#7c984a;color:#fff;font-weight:500"align="center">
                            <a href="{% url 'module_comptabilite_list_note_cas_13' %}" target="_blank">NOTE 13</a></td>
                        <td style="background-color:#f1f1f1;color:#000;font-weight:500"align="center">CAPITAL : VALEUR NOMINALE DES ACTIONS OU PARTS </td>
                    </tr>
                    <tr>
                        <td style="background-color:#7c984a;color:#fff;font-weight:500"align="center">
                            <a href="{% url 'module_comptabilite_list_note_cas_14' %}" target="_blank">NOTE 14</a></td>
                        <td style="background-color:#f1f1f1;color:#000;font-weight:500"align="center">PRIMES ET RESERVES </td>
                    </tr>
                    <tr>
                        <td style="background-color:#7c984a;color:#fff;font-weight:500"align="center">
                            <a href="{% url 'module_comptabilite_list_note_cas_15' %}" target="_blank">NOTE 15A</a> </td>
                        <td style="background-color:#f1f1f1;color:#000;font-weight:500"align="center">SUBVENTIONS ET PROVISIONS REGLEMENTEES </td>
                    </tr>

                    <tr>
                        <td style="background-color:#7c984a;color:#fff;font-weight:500"align="center">
                            <a href="{% url 'module_comptabilite_list_note_cas_15B' %}" target="_blank">NOTE 15B</a> </td>
                        <td style="background-color:#f1f1f1;color:#000;font-weight:500"align="center">AUTRES FONDS PROPRES</td>
                    </tr>
                    <tr>
                        <td style="background-color:#7c984a;color:#fff;font-weight:500"align="center">
                            <a href="{% url 'module_comptabilite_list_note_cas_16A' %}" target="_blank">NOTE 16A</a></td>
                        <td style="background-color:#f1f1f1;color:#000;font-weight:500"align="center"> DETTES FINANCIERES ET RESSOURCES ASSIMILEES </td>
                    </tr>
                    <tr>
                        <td style="background-color:#7c984a;color:#fff;font-weight:500"align="center">
                            <a href="{% url 'module_comptabilite_list_note_cas_16B' %}" target="_blank">NOTE 16B</a></td>
                        <td style="background-color:#f1f1f1;color:#000;font-weight:500"align="center">ENGAGEMENTS DE RETRAITE ET AVANTAGES ASSIMILES (METHODE ACTUARIELLE) </td>
                    </tr>
                    <tr>
                        <td style="background-color:#7c984a;color:#fff;font-weight:500"align="center">NOTE 16B </td>
                        <td style="background-color:#f1f1f1;color:#000;font-weight:500"align="center"> bis ENGAGEMENTS DE RETRAITE ET AVANTAGES ASSIMILES (METHODE ACTUARIELLE)</td>
                    </tr>
                    <tr>
                        <td style="background-color:#7c984a;color:#fff;font-weight:500"align="center">
                            <a href="{% url 'module_comptabilite_list_note_cas_16C' %}" target="_blank">NOTE 16C</a></td>
                        <td style="background-color:#f1f1f1;color:#000;font-weight:500"align="center">ACTIFS ET PASSIFS EVENTUELS </td>
                    </tr>
                    <tr>
                        <td style="background-color:#7c984a;color:#fff;font-weight:500"align="center">
                            <a href="{% url 'module_comptabilite_list_note_cas_17' %}" target="_blank">NOTE 17</a></td>
                        <td style="background-color:#f1f1f1;color:#000;font-weight:500"align="center">FOURNISSEURS D'EXPLOITATION </td>
                    </tr>
                    <tr>
                        <td style="background-color:#7c984a;color:#fff;font-weight:500"align="center">
                            <a href="{% url 'module_comptabilite_list_note_cas_18' %}" target="_blank">NOTE 18</a></td>
                        <td style="background-color:#f1f1f1;color:#000;font-weight:500"align="center">DETTES FISCALES ET SOCIALES </td>
                    </tr>
                    <tr>
                        <td style="background-color:#7c984a;color:#fff;font-weight:500"align="center">
                            <a href="{% url 'module_comptabilite_list_note_cas_19' %}" target="_blank">NOTE 19</a></td>
                        <td style="background-color:#f1f1f1;color:#000;font-weight:500"align="center">AUTRES DETTES ET PROVISIONS POUR RISQUES A COURT TERME </td>
                    </tr>

                    <tr>
                        <td style="background-color:#7c984a;color:#fff;font-weight:500"align="center">
                            <a href="{% url 'module_comptabilite_list_note_cas_20' %}" target="_blank">NOTE 20</a></td>
                        <td style="background-color:#f1f1f1;color:#000;font-weight:500"align="center">BANQUES, CREDIT D'ESCOMPTE ET DE TRESORERIE </td>
                    </tr>
                    <tr>
                        <td style="background-color:#7c984a;color:#fff;font-weight:500"align="center">
                            <a href="{% url 'module_comptabilite_list_note_cas_21' %}" target="_blank">NOTE 21</a></td>
                        <td style="background-color:#f1f1f1;color:#000;font-weight:500"align="center">CHIFFRE D'AFFAIRES ET AUTRES PRODUITS </td>
                    </tr>
                    <tr>
                        <td style="background-color:#7c984a;color:#fff;font-weight:500"align="center">
                            <a href="{% url 'module_comptabilite_list_note_cas_22' %}" target="_blank">NOTE 22</a></td>
                        <td style="background-color:#f1f1f1;color:#000;font-weight:500"align="center">ACHATS NOTE </td>
                    </tr>
                    <tr>
                        <td style="background-color:#7c984a;color:#fff;font-weight:500"align="center">
                            <a href="{% url 'module_comptabilite_list_note_cas_23' %}" target="_blank">NOTE 23</a></td>
                        <td style="background-color:#f1f1f1;color:#000;font-weight:500"align="center">TRANSPORTS NOTE </td>
                    </tr>

                    <tr>
                        <td style="background-color:#7c984a;color:#fff;font-weight:500"align="center">
                            <a href="{% url 'module_comptabilite_list_note_cas_24' %}" target="_blank">NOTE 24</a></td>
                        <td style="background-color:#f1f1f1;color:#000;font-weight:500"align="center">SERVICES EXTERIEURS </td>
                    </tr>
                    <tr>
                        <td style="background-color:#7c984a;color:#fff;font-weight:500"align="center">
                            <a href="{% url 'module_comptabilite_list_note_cas_25' %}" target="_blank">NOTE 25</a></td>
                        <td style="background-color:#f1f1f1;color:#000;font-weight:500"align="center">IMPOTS ET TAXES </td>
                    </tr>
                    <tr>
                        <td style="background-color:#7c984a;color:#fff;font-weight:500"align="center">
                            <a href="{% url 'module_comptabilite_list_note_cas_26' %}" target="_blank">NOTE 26</a></td>
                        <td style="background-color:#f1f1f1;color:#000;font-weight:500"align="center">AUTRES CHARGES </td>
                    </tr>
                    <tr>
                        <td style="background-color:#7c984a;color:#fff;font-weight:500"align="center">
                            <a href="{% url 'module_comptabilite_list_note_cas_27' %}" target="_blank">NOTE 27A</a></td>
                        <td style="background-color:#f1f1f1;color:#000;font-weight:500"align="center">CHARGES DE PERSONNEL </td>
                    </tr>

                    <tr>
                        <td style="background-color:#7c984a;color:#fff;font-weight:500"align="center">
                            <a href="{% url 'module_comptabilite_list_note_cas_27B' %}" target="_blank">NOTE 27B</a></td>
                        <td style="background-color:#f1f1f1;color:#000;font-weight:500"align="center">EFFECTIFS, MASSE SALARIALE ET PERSONNEL EXTERIEUR </td>
                    </tr>
                    <tr>
                        <td style="background-color:#7c984a;color:#fff;font-weight:500"align="center">
                            <a href="{% url 'module_comptabilite_list_note_cas_28' %}" target="_blank">NOTE 28</a></td>
                        <td style="background-color:#f1f1f1;color:#000;font-weight:500"align="center">PROVISIONS ET DEPRECIATIONS INSCRITES AU BILAN </td>
                    </tr>
                    <tr>
                        <td style="background-color:#7c984a;color:#fff;font-weight:500"align="center">
                            <a href="{% url 'module_comptabilite_list_note_cas_29' %}" target="_blank">NOTE 29</a></td>
                        <td style="background-color:#f1f1f1;color:#000;font-weight:500"align="center"> CHARGES ET REVENUS FINANCIERS </td>
                    </tr>
                    <tr>
                        <td style="background-color:#7c984a;color:#fff;font-weight:500"align="center">
                            <a href="{% url 'module_comptabilite_list_note_cas_30' %}" target="_blank">NOTE 30</a></td>
                        <td style="background-color:#f1f1f1;color:#000;font-weight:500"align="center">AUTRES CHARGES ET PRODUITS HAO </td>
                    </tr>
                    <tr>
                        <td style="background-color:#7c984a;color:#fff;font-weight:500"align="center">
                            <a href="{% url 'module_comptabilite_list_note_cas_31' %}" target="_blank">NOTE 31</a></td>
                        <td style="background-color:#f1f1f1;color:#000;font-weight:500"align="center"> REPARTITION DU RESULTAT ET AUTRES ELEMENTS CARACTERISTIQUES DES CINQ DERNIERS EXERCICES </td>
                    </tr>
                    <tr>
                        <td style="background-color:#7c984a;color:#fff;font-weight:500"align="center">
                            <a href="{% url 'module_comptabilite_list_note_cas_32' %}" target="_blank">NOTE 32</a2</td>
                        <td style="background-color:#f1f1f1;color:#000;font-weight:500"align="center"> PRODUCTION DE L'EXERCICE </td>
                    </tr>
                    <tr>
                        <td style="background-color:#7c984a;color:#fff;font-weight:500"align="center">
                            <a href="{% url 'module_comptabilite_list_note_cas_33' %}" target="_blank">NOTE 33</a></td>
                        <td style="background-color:#f1f1f1;color:#000;font-weight:500"align="center">ACHATS DESTINES A LA PRODUCTION </td>
                    </tr>
                    <tr>
                        <td style="background-color:#7c984a;color:#fff;font-weight:500"align="center">
                            <a href="{% url 'module_comptabilite_list_note_cas_34' %}" target="_blank">NOTE 34</a></td>
                        <td style="background-color:#f1f1f1;color:#000;font-weight:500"align="center">FICHE DE SYNTHESE DES PRINCIPAUX INDICATEURS FINANCIERS </td>
                    </tr>
                    <tr>
                        <td style="background-color:#7c984a;color:#fff;font-weight:500"align="center">
                            <a href="{% url 'module_comptabilite_list_note_cas_35' %}" target="_blank">NOTE 35</a></td>
                        <td style="background-color:#f1f1f1;color:#000;font-weight:500"align="center">LISTE DES INFORMATIONS SOCIALES, ENVIRONNEMENTALES ET SOCIETALES A FOURNIR </td>
                    </tr>
                    <tr>
                        <td style="background-color:#7c984a;color:#fff;font-weight:500"align="center">
                            <a href="{% url 'module_comptabilite_list_note_cas_36' %}" target="_blank">NOTE 31</a></td>
                        <td style="background-color:#f1f1f1;color:#000;font-weight:500"align="center">TABLES DES CODES</td>
                    </tr>
                </table>
            </div>
            <br>
            <br>
        </div>

        <script>
            var equilibre_credit = 0;
            var equilibre_debit = 0;
            var devise = "";

            {% for item in model %}
                equilibre_debit += parseFloat("{{ item.debit }}");
                equilibre_credit += parseFloat("{{ item.credit }}");
            {% endfor %}

            $(document).ready(function(){
                $("#equilibre_credit").text(equilibre_credit.toFixed(2));
                $("#equilibre_debit").text(equilibre_debit.toFixed(2));
            });

            function printScreen() {
                const filename  = 'journal.pdf';

                /*var pdf = new jsPDF('p', 'pt', 'a4');
                pdf.addHTML(document.getElementById('divToPrint'), 25, 50, {
                    retina: true,
                    pagesplit: true,
                    margin: {
                    top: 50,
                    right: 25,
                    bottom: 50,
                    left: 25,
                    useFor: 'page' // This property is mandatory to keep the margin to supsequent pages
                    }
                }, function() {
                    pdf.save('test.pdf');
                });*/

                var pdf = new jsPDF('l', 'pt', 'a3');
                pdf.html($('#divToPrint')[0], {
                    callback: function (pdf) {
                        //pdf.save();
                        //headerFooterFormatting(pdf, pdf.internal.getNumberOfPages());
                        var string = pdf.output('datauristring');
                        $('#iframemodal').attr('src', string);
                        $('#lancermodal').click();
                    }
                });

                /*html2canvas(document.querySelector('#divToPrint')).then(canvas => {
                    let pdf = new jsPDF('p', 'mm', 'a4');
                    pdf.addImage(canvas.toDataURL('image/png'), 'PNG', 0, 0, 211, 298);
                    pdf.save(filename);
                });*/

                //Imprimer avec plus de fonctionnalités sur sheetjs

                margins = {
                    top: 70,
                    bottom: 40,
                    left: 30,
                    width: 550
                };

                /*var pdf = new jsPDF('p', 'pt', 'a4');
                pdf.setFontSize(18);
                pdf.fromHTML(document.getElementById('divToPrint'),
                    margins.left, // x coord
                    margins.top,
                    {
                        // y coord
                        width: margins.width// max width of content on PDF
                    },function(dispose) {
                        headerFooterFormatting(pdf, pdf.internal.getNumberOfPages());
                    },
                    margins);

                //pdf.save();
                var string = pdf.output('datauristring');
                $('#iframemodal').attr('src', string);
                $('#lancermodal').click();*/
            }
            var base64Img = null;
            imgToBase64('{% static 'ErpProject/image/logo_arpce_large.png' %}', function(base64) {
                base64Img = base64;
            });

            //Fonction to convert image to base64
            function imgToBase64(url, callback, imgVariable) {
                if (!window.FileReader) {
                    callback(null);
                    return;
                }
                var xhr = new XMLHttpRequest();
                xhr.responseType = 'blob';
                xhr.onload = function() {
                    var reader = new FileReader();
                    reader.onloadend = function() {
                        imgVariable = reader.result.replace('text/xml', 'image/jpeg');
                        callback(imgVariable);
                    };
                    reader.readAsDataURL(xhr.response);
                };
                xhr.open('GET', url);
                xhr.send();
            };

            //Fonction pour le header
            function header(doc)
            {
                doc.setFontSize(30);
                doc.setTextColor(40);
                doc.setFontStyle('normal');
                if (base64Img) {
                    doc.addImage(base64Img, 'JPEG', margins.left, 10, 40,40);
                }
                doc.text("Report Header Template", margins.left + 50, 40 );
                doc.setLineCap(2);
                doc.line(3, 70, margins.width + 43,70); // horizontal line
            };

            //Fonction pour le footer
            function footer(doc, pageNumber, totalPages){
                var str = "Page " + pageNumber + " of " + totalPages
                doc.setFontSize(10);
                doc.text(str, margins.left, doc.internal.pageSize.height - 20);
            };

            //Fonction de configuration pour le header et footer
            function headerFooterFormatting(doc, totalPages)
            {
                for(var i = totalPages; i >= 1; i--)
                {
                    doc.setPage(i);
                    //header
                    header(doc);
                    footer(doc, i, totalPages);
                    doc.page++;
                }
            };

            //Exporter en Excel
            var wb = XLSX.utils.table_to_book(document.getElementById('rapport'), {sheet:"Sheet JS"});
            var wbout = XLSX.write(wb, {bookType:'xlsx', bookSST:true, type: 'binary'});
            function s2ab(s) {
                var buf = new ArrayBuffer(s.length);
                var view = new Uint8Array(buf);
                for (var i=0; i<s.length; i++) view[i] = s.charCodeAt(i) & 0xFF;
                return buf;
            }
            $("#btn_export").click(function(){
                console.log("btn_export cliquee");
                saveAs(new Blob([s2ab(wbout)],{type:"application/octet-stream"}), 'test.xlsx');
            });
        </script>
{% endblock %}
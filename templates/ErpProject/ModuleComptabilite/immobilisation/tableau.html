{% extends "ErpProject/ModuleComptabilite/shared/layout.html" %}
{% block page %}
{%load static %}
{% load account_filters %}
<div class="row">
    <ul class="breadcrumb">
        <li><a><span class="mif-home"></span></a></li>
        <li><a class="chargement-au-click" href="{% url 'module_comptabilite_tableau_de_bord' %}">Module Comptabilité</a></li>
        <li>{{ title }}</li>

</div>


    <hr class="hr-ligne">
    <!-- Appel de la fonction message -->
        {% include 'ErpProject/ErpBackOffice/widget/message.html' with messages=messages only %}
    <!--br>
    <button onclick="printScreen();" class="theme-btn theme-btn-sm rounded primary_color_{{module.name|lower}} chargement-au-click">Imprimer</button-->

    <!-- Impression -->
    <form method="POST" action="{% url 'back_office_print_objet' %}">
        {% csrf_token %}
        <input type="hidden" name="id" value={{model.id}}>
        <input type="hidden" name="dao" value="print_tableau_amortissement(id)">
        <input type="hidden" name="previous" value="{{ request.path }}">
        <button type="submit" class="btn btn-default" style="background-color: #41435d;border:none;color: white;">Imprimer</button>
    </form>
<!-- Fin impression -->
<br><br>

    <div class="row item-content" style="margin-top: 20px">
        <div class="col-md-12">
            <div id="divToPrint" class="row">
                <h2>Tableau d'amortissement</h2>
                <br>
                <table class="table border bordered">
                    <thead>
                        <tr>
                            <th width="10%">Immobilisation</th>
                            <th width="10%">Asset</th>
                            <th width="10%">Article</th>
                            <th width="10%">Type</th>
                            <th width="10%">Valeur d'acquisition</th>
                            <th width="10%">Dotation</th>
                            <th width="10%">Cumul</th>
                            <th width="10%">Valeur Résiduelle</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for immobilisation in immobilisations %}
                        <tr class="table bordered border">
                                <td> {{immobilisation.code}}</td>
                                <td> {{immobilisation.immobilier.numero_identification}}</td>
                                <td> {{immobilisation.immobilier.article.designation}}</td>
                                <td> {{immobilisation.value_type_amortissement}} </td>
                                <td> {{immobilisation.valeur_immobilier |monetary}} </td>
                                <td> {{immobilisation.valeur_dotation |monetary}} </td>
                                <td> {{immobilisation.valeur_cumul_amortissement |monetary}} </td>
                                <td> {{immobilisation.valeur_residuelle |monetary}} </td>
                            </tr>
                        {% endfor %}

                    </tbody>
                </table>
            </div>
        </div>

    </div>
    <button type="button" id="lancermodal" data-toggle="modal" data-target="#monmodal"
        style="display: none;">executer</button>
    <div id="monmodal" class="modal fade" role="dialog">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-body">
                    <center>
                        <iframe id="iframemodal" frameborder="0" style="width: 100%;" height="600px"></iframe>
                    </center>
                    <hr>
                    <center>
                        <button type="button" class="btn btn-danger" data-dismiss="modal">FERMER</button>
                    </center>
                </div>
            </div>
        </div>
    </div>
    <script type="text/javascript" src="{% static 'ErpProject/js/pdf/print.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'ErpProject/js/pdf/libs/jspdf.debug.js' %}"></script>
    <script type="text/javascript" src="{% static 'ErpProject/js/pdf/libs/cell.js' %}"></script>
    <script type="text/javascript" src="{% static 'ErpProject/js/pdf/libs/jspdf.plugin.autotable.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'ErpProject/js/pdf/libs/from_html.js' %}"></script>
    <script type="text/javascript" src="{% static 'ErpProject/js/pdf/libs/html2canvas.min.js' %}"></script>
    <script>
        function printScreen() {
            const filename = 'tableau_amortissement.pdf';
            var pdf = new jsPDF('l', 'pt', 'ledger');
            pdf.html($('#divToPrint')[0], {
                callback: function (pdf) {

                    var string = pdf.output('datauristring');
                    $('#iframemodal').attr('src', string);
                    $('#lancermodal').click();
                }
            });

            margins = {
                top: 70,
                bottom: 40,
                left: 30,
                width: 550
            };


        }
    </script>
{% endblock %}
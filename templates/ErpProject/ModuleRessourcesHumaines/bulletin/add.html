{% extends "ErpProject/ModuleRessourcesHumaines/shared/layout.html" %}
{% block page %}
	<div class="row">
		<ul class="breadcrumb">
			<li><a><span class="mif-home"></span></a></li>
			<li><a class="leaf" href="{% url 'module_rh_tableau_de_bord' %}">Module Ressources humaines</a></li>
			<li><a class="chargement-au-click" href="{% url 'module_ressources_humaines_list_bulletin' %}">Liste des Bulletins</a></li>
			<li>{{ title }}</li>
		</ul>
	</div>
	<div class="row">
		<div class="col-lg-12">
			<h3>{{ title }}</h3>
			<strong style="float: right;color: grey;opacity: 0.85;margin-top: -30px;">{% now "jS F Y H:i" %}</strong>
			<div class="separ" style="background-color: grey;opacity: 0.2"></div>
			<div class="panel panel-default" style="border: none;">
				<div class="panel panel-body" style="background-color:#f5f5f5;border: none;border-radius: none;">
					<div class="row">
						<button onclick="javascript:document.getElementById('submit').click()" class="theme-btn theme-btn-sm rounded primary_color_{{module.name|lower}}" style="width: 20%;">
							Valider
						</button>
						<button onclick="javascript:window.location.assign('{% url 'module_ressources_humaines_list_bulletin' %}')" class="theme-btn theme-btn-sm rounded chargement-au-click" style="width: 20%;margin-left: 5px">Annuler</button>
					</div>

					<hr class="hr-ligne">
					<!-- Appel de la fonction message -->
						{% include 'ErpProject/ErpBackOffice/widget/message.html' with messages=messages only %}
					<br><br>
					<form id="form" method="POST" action="{% url 'module_ressources_humaines_valider_bulletin' %}"
						data-role="validator" 
						data-show-required-state="false"
						data-hint-mode="line"
						data-hint-background="bg-red"
						data-hint-color="fg-white"
						data-hide-error="5000"
						novalidate="novalidate"
						data-on-error-input="notifyOnErrorInput"
						data-show-error-hint="false">
						{% csrf_token %}
						<input id="submit" type="submit" style="display: none">

						<div class="row">
							<div class="col-md-6">
								<label>Employé</label>
								<div class="input-control text full-size">
									<select name="employe_id" id="employe_id" 
										data-validate-func="min" 
										data-validate-arg="1"
										data-validate-hint="Sélectionnez un employé svp.">
										<option value="0">Sélectionnez un employé</option>
											{% for item in employes %}
												<option value="{{ item.id }}"> {{ item.nom_complet }} </option>
											{% endfor %}
										</select>
									</div>
								</div>
							<div class="col-md-6">
								<label>Lot de bulletins</label>
								<div class="input-control text full-size">
									<select name="lot_id" id="lot_id" 
										data-validate-func="min" 
										data-validate-arg="1"
										data-validate-hint="Sélectionnez un lot de bulletin svp.">
										<option value="0">Sélectionnez un lot</option>
										{% for item in lots %}
											<option value="{{ item.id }}"> {{ item.designation }} </option>
										{% endfor %}
									</select>
								</div>
							</div>
						</div>

						<div class="row">
							<div class="col-md-6">
								<label>Désignation</label>
								<div class="input-control text full-size" data-role="input">
									<input name="designation" id="designation_bulletin" type="text" autocomplete="off"
										data-validate-func="required" 
										data-validate-hint="Entrez la désignation du poste!">
									<span class="input-state-error mif-warning"></span>
									<span class="input-state-success mif-checkmark"></span>
								</div>
							</div>

							<div class="col-md-6">
								<label>Référence</label>
								<div class="input-control text full-size">
									<input type="text" name="reference" id="reference_bulletin" autocomplete="off" />
								</div>
							</div>
						</div>

						<div class="row">
							<div class="col-md-6">
								<label>Devise</label>
									<div class="input-control text full-size">
									<select name="devise_id" id="devise_id"
										data-validate-func="min" 
										data-validate-arg="1"
										data-validate-hint="Sélectionnez la devise svp.">
										<option value="0">Sélectionnez une devise</option>
										{% for item in devises %}
											<option value="{{ item.id }}"> {{ item.designation }} </option>
										{% endfor %}
									</select>
								</div>
							</div>
						</div>
						
						<br/>

						<div class="row" style="margin-top: 20px">
							<div class="tabcontrol2" data-role="tabcontrol">
								<ul class="tabs">
									<li class="active"><a href="#frame_a_payer">A payer</a></li>
									<li class=""><a href="#frame_a_retenir">A retenir</a></li>
									<li class=""><a href="#frame_comptabilite">Comptabilité</a></li>
								</ul>
								<div class="frames">
									<div class="frame" id="frame_a_payer" style="display: block;">
										<table class="table no-margin">
											<thead class="no-border">
												<tr class="primary_color_{{module.name|lower}}">
													<th width="30%">Elément</th>
													<th width="15%">Temps</th>
													<th width="25%">Taux</th>
													<th width="25%">Montant</th>
													<th width="5%"></th>
												</tr>
											</thead>
											<tbody id="items_apayer">
												<tr id="ligne_apayer1">
													<td class="no-padding-top no-padding-left no-padding-bottom">
														<input id="id_apayer1" type="hidden" value="0" />
														<div class="input-control select full-size">
															<select onchange="selectChangeApayer(event)" name="element_apayer_id" id="apayer1">
																<option value="0">Sélectionnez un élément à payer</option>
																{% for item in elements_apayer %}
																	<option data-ligne="1" data-categorie="{{ item.categorie_element }}" data-type="{{ item.type_element }}" data-montant="{{ item.montant }}" value="{{ item.id }}">{{ item.designation }}</option>
																{% endfor %}
															</select>
														</div>
													</td>
													<td class="no-padding-top no-padding-bottom">
														<div class="input-control text full-size">
															<input onchange="inputChangeApayer(event)" data-ligne="1" id="temps_apayer1" name="temps" type="text" placeholder="Ex: 10">
														</div>
													</td>
													<td class="no-padding-top no-padding-bottom">
														<div class="input-control text full-size">
															<input onchange="inputChangeApayer(event)" data-ligne="1" id="taux_apayer1" name="taux" type="text" placeholder="Ex: 100">
															<span class="prepend-icon" style="margin-left:75%">
																<span style="margin-top: 1px;" class="sub-header place-right devise">{{ devise_ref.symbole_devise }}</span>
															</span>
														</div>
													</td>
													<td class="no-padding-top no-padding-bottom">
														<div class="input-control text full-size">
															<input class="monetary" id="montant_apayer1" name="montant" type="text" placeholder="Ex: 100">
															<span class="prepend-icon" style="margin-left:75%">
																<span style="margin-top: 1px;" class="sub-header place-right devise">{{ devise_ref.symbole_devise }}</span>
															</span>
														</div>
													</td>
													<td class="no-padding-top no-padding-bottom">
														<div class="pagination no-border">
															<span class="item" title="Supprimer l'élément" onclick="supprimerApayer(1)"><span class="mif-cross fg-red"></span></span>
														</div>
													</td>
												</tr>
											</tbody>
										</table>
										<div class="row margin10 no-margin-left no-margin-right">
											<button type="button" class="button rounded" id="btnAjouterApayer">Ajouter un élément à payer</button>
										</div>
									</div>
									<div class="frame" id="frame_a_retenir" style="display: none;">
										<table class="table no-margin">
											<thead class="no-border">
												<tr class="primary_color_{{module.name|lower}}">
													<th width="30%">Elément</th>
													<th width="15%">Temps</th>
													<th width="25%">Taux</th>
													<th width="25%">Montant</th>
													<th width="5%"></th>
												</tr>
											</thead>
											<tbody id="items_aretenir">
												<tr id="ligne_aretenir1">
													<td class="no-padding-top no-padding-left no-padding-bottom">
														<input id="id_aretenir1" type="hidden" value="0" />
														<div class="input-control select full-size">
															<select onchange="selectChangeAretenir(event)" name="element_aretenir_id" id="aretenir1">
																<option value="0">Sélectionnez un élément à retenir</option>
																{% for item in elements_aretenir %}
																	<option data-ligne="1" data-type="{{ item.type_element }}" data-montant="{{ item.montant }}" value="{{ item.id }}">{{ item.designation }}</option>
																{% endfor %}
															</select>
														</div>
													</td>
													<td class="no-padding-top no-padding-bottom">
														<div class="input-control text full-size">
															<input id="temps_aretenir1" name="temps" type="text" placeholder="Ex: 10">
														</div>
													</td>
													<td class="no-padding-top no-padding-bottom">
														<div class="input-control text full-size">
															<input onchange="inputChangeAretenir(event)" data-ligne="1" id="taux_aretenir1" name="taux" type="text" placeholder="Ex: 100">
															<span class="prepend-icon" style="margin-left:75%">
																<span style="margin-top: 1px;" class="sub-header place-right devise">{{ devise_ref.symbole_devise }}</span>
															</span>
														</div>
													</td>
													<td class="no-padding-top no-padding-bottom">
														<div class="input-control text full-size">
															<input class="monetary"  onchange="inputChangeAretenir(event)" data-ligne="1" id="montant_aretenir1" name="montant" type="text" placeholder="Ex: 100">
															<span class="monetary"  class="prepend-icon" style="margin-left:75%">
																<span style="margin-top: 1px;" class="sub-header place-right devise">{{ devise_ref.symbole_devise }}</span>
															</span>
														</div>
													</td>
													<td class="no-padding-top no-padding-bottom">
														<div class="pagination no-border">
															<span class="item" title="Supprimer l'élément" onclick="supprimerAretenir(1)"><span class="mif-cross fg-red"></span></span>
														</div>
													</td>
												</tr>
											</tbody>
										</table>
										<div class="row margin10 no-margin-left no-margin-right">
											<button type="button" class="button rounded" id="btnAjouterAretenir">Ajouter un élément à retenir</button>
										</div>
									</div>
									<div class="frame" id="frame_comptabilite" style="display: none;">
										<div class="row cells3">
											<div class="cell">
												<div class="row">
													<label>Comptabilité</label><br>
													<label class="input-control checkbox small-check full-size" >
														<input value="1" name="est_comptabilisable" id="est_comptabilisable" type="checkbox">
														<span class="check"></span>
														<span class="caption">Établir l'ordre de paiement</span>
													</label>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>				
					</form>
        		</div>        
    		</div>
		</div>
	</div>
	<script src="/static/ErpProject/js/bulletin-local.js"></script>
	<script>
		var nombreLignes_apayer = 1;
        var nombreItems_apayer = 0;
        var ligneActuelle_apayer = 0;
        var compteur_apayer = 1;
		
		var nombreLignes_aretenir = 1;
        var nombreItems_aretenir = 0;
        var ligneActuelle_aretenir = 0;
        var compteur_aretenir = 1;
		
		var deviseRef = "$";   
        var lesDevises = new Array();
		var lesElementsApayer = new Array();
		var lesElementsAretenir = new Array();

        {% for item in devises %}
            lesDevises.push({id:"{{ item.id }}", designation:"{{ item.designation }}", symbole_devise:"{{ item.symbole_devise }}"});
        {% endfor %}
		
		{% for item in elements_apayer %}
            lesElementsApayer.push({id:"{{ item.id }}", designation:"{{ item.designation }}", type_element:"{{ item.type_element }}", categorie_element:"{{ item.categorie_element }}", montant:"{{ item.montant }}"});
        {% endfor %}

		{% for item in elements_aretenir %}
            lesElementsAretenir.push({id:"{{ item.id }}", designation:"{{ item.designation }}", type_element:"{{ item.type_element }}", categorie_element:"{{ item.categorie_element }}", montant:"{{ item.montant }}"});
        {% endfor %}
		
        $(document).ready(function(){
		
			$("#devise_id").change(function() {			  
				var id_devise = $("#devise_id").val();
				if(id_devise == "0") deviseRef = "$";
				else
				{
					for(var i = 0; i < lesDevises.length; i++)
					{
						var devise = lesDevises[i];
						if(devise.id == id_devise)
						{
							deviseRef = devise.symbole_devise;
							$(".devise").text(deviseRef);
							break;
						}
					}
				}			  
			});
			
			$("#btnAjouterApayer").on("click", function () {
				nombreLignes_apayer++;
				compteur_apayer++;
				var nouvelleLigne = '<tr id="ligne_apayer' + compteur_apayer + '"><td class="no-padding-top no-padding-left no-padding-bottom">';
				nouvelleLigne += '<input id="id_apayer' + compteur_apayer + '" type="hidden" value="0" />';
				nouvelleLigne += '<div class="input-control select full-size"> <select onchange="selectChangeApayer(event)" name="element_apayer_id" id="apayer' + compteur_apayer + '"><option value="0">Sélectionnez un élément à payer</option>';
				nouvelleLigne += renvoyerElementsApayer(compteur_apayer);
				nouvelleLigne += '</select></div></td>';
				nouvelleLigne += '<td class="no-padding-top no-padding-bottom"><div class="input-control text full-size"><input onchange="inputChangeApayer(event)" data-ligne="' + compteur_apayer + '" id="temps_apayer' + compteur_apayer + '" name="temps" type="text" placeholder="Ex: 0.10"></div></td>';								
				nouvelleLigne += '<td class="no-padding-top no-padding-bottom"><div class="input-control text full-size"><input onchange="inputChangeApayer(event)" data-ligne="' + compteur_apayer + '"  id="taux_apayer' + compteur_apayer + '" name="taux" type="text" autocomplete="off" placeholder="Ex: 0" data-validate-func="number" data-validate-arg="1" data-validate-hint="Précisez le taux svp"><span class="prepend-icon" style="margin-left:75%"><span style="margin-top: 1px;" class="sub-header place-right devise">' + deviseRef + '</span></span></div></td>';																									
				nouvelleLigne += '<td class="no-padding-top no-padding-bottom"><div class="input-control text full-size"><input class="monetary"  id="montant_apayer' + compteur_apayer + '" name="montant" type="text" autocomplete="off" placeholder="Ex: 43680" data-validate-func="number" data-validate-arg="1" data-validate-hint="Précisez le montant à payer svp"><span class="prepend-icon" style="margin-left:75%"> <span style="margin-top: 1px;" class="sub-header place-right devise">' + deviseRef + '</span></span></div></td>';								
				nouvelleLigne += '<td class="no-padding-top no-padding-bottom"><div class="pagination no-border"><span class="item" title="Supprimer l\'élément" onclick="supprimerApayer(' + compteur_apayer + ')"><span class="mif-cross fg-red"></span></span></div></td></tr>';		
				$("#items_apayer").append(nouvelleLigne);
			});

			$("#btnAjouterAretenir").on("click", function () {
				nombreLignes_aretenir++;
				compteur_aretenir++;
				var nouvelleLigne = '<tr id="ligne_aretenir' + compteur_aretenir + '"><td class="no-padding-top no-padding-left no-padding-bottom">';
				nouvelleLigne += '<input id="id_aretenir' + compteur_aretenir + '" type="hidden" value="0" />';
				nouvelleLigne += '<div class="input-control select full-size"> <select onchange="selectChangeAretenir(event)" name="element_aretenir_id" id="aretenir' + compteur_aretenir + '"><option value="0">Sélectionnez un élément à retenir</option>';
				nouvelleLigne += renvoyerElementsAretenir(compteur_aretenir);
				nouvelleLigne += '</select></div></td>';									
				nouvelleLigne += '<td class="no-padding-top no-padding-bottom"><div class="input-control text full-size"><input onchange="inputChangeAretenir(event)" data-ligne="' + compteur_aretenir + '" id="temps_aretenir' + compteur_aretenir + '" name="temps" type="text" placeholder="Ex: 0.10"></div></td>';								
				nouvelleLigne += '<td class="no-padding-top no-padding-bottom"><div class="input-control text full-size"><input onchange="inputChangeAretenir(event)" data-ligne="' + compteur_aretenir + '" id="taux_aretenir' + compteur_aretenir + '" name="taux"" type="text" autocomplete="off" placeholder="Ex: 0" data-validate-func="number" data-validate-arg="1" data-validate-hint="Précisez la taux svp"><span class="prepend-icon" style="margin-left:75%"><span style="margin-top: 1px;" class="sub-header place-right devise">' + deviseRef + '</span></span></div></td>';																										
				nouvelleLigne += '<td class="no-padding-top no-padding-bottom"><div class="input-control text full-size"><input class="monetary"  id="montant_aretenir' + compteur_aretenir + '" name="montant" type="text" autocomplete="off" placeholder="Ex: 43680" data-validate-func="number" data-validate-arg="1" data-validate-hint="Précisez le montant à retenir svp"><span class="prepend-icon" style="margin-left:75%"> <span style="margin-top: 1px;" class="sub-header place-right devise">' + deviseRef + '</span></span></div></td>';								
				nouvelleLigne += '<td class="no-padding-top no-padding-bottom"><div class="pagination no-border"><span class="item" title="Supprimer l\'élément" onclick="supprimerAretenir(' + compteur_aretenir + ')"><span class="mif-cross fg-red"></span></span></div></td></tr>';		
				$("#items_aretenir").append(nouvelleLigne);
			});			
		});
		
		function selectChangeApayer(event)
        {
            $select = $(event.target); 
            var id_element = $select[0].id; //window.location.assign(""); //window.location.reload(true)
            console.log("ID ELEMENT : " + id_element);
            if(id_element.substring(0, 6) == "apayer")
            {
                //ligneActuelle = $select[0].id.substr($select[0].name.length - 1, 1);
				var ligneActuelle = $( "#" + id_element + " option:selected" ).data("ligne");
				console.log("Ligne Actuelle : " + ligneActuelle);

				var typeActuelle = $( "#" + id_element + " option:selected" ).data("type");
				console.log("Type Actuelle : " + typeActuelle);

				var montantActuelle = $( "#" + id_element + " option:selected" ).data("montant");
				console.log("Montant Actuelle : " + montantActuelle);
				
                if($("#" + id_element).val() != "0")
                {
                    nombreItems_apayer += 1;
                    $("#temps_apayer" + ligneActuelle).val("1");
					$("#taux_apayer" + ligneActuelle).val(montantActuelle);
					$("#montant_apayer" + ligneActuelle).val(montantActuelle);
					
                }
                else nombreItems_apayer -= 1;
            }
        }
		
		function inputChangeApayer(event)
        {
            $input = $(event.target); 
            var id_element = $input[0].id; //window.location.assign(""); //window.location.reload(true)
            console.log("ID ELEMENT : " + id_element);
			var ligneActuelle = $( "#" + id_element ).data("ligne");
			console.log("Ligne Actuelle : " + ligneActuelle);
			var temps = parseFloat($("#temps_apayer" + ligneActuelle).val());
			console.log("Temps : " + temps);
			var taux = parseFloat($("#taux_apayer" + ligneActuelle).val()).toFixed(2);
			console.log("Taux : " + taux);
			
            if(!isNaN(temps) && !isNaN(taux))
            {
                console.log("Is Float ");
				var montantActuelle = temps * taux ;
				montantActuelle = parseFloat(montantActuelle).toFixed(2)
				$("#montant_apayer" + ligneActuelle).val(montantActuelle);
            }
        }
		
		function selectChangeAretenir(event)
        {
            $select = $(event.target); 
            var id_element = $select[0].id; //window.location.assign(""); //window.location.reload(true)
            console.log("ID ELEMENT : " + id_element);
            if(id_element.substring(0, 8) == "aretenir")
            {
                //ligneActuelle = $select[0].id.substr($select[0].name.length - 1, 1);
				var ligneActuelle = $( "#" + id_element + " option:selected" ).data("ligne");
				console.log("Ligne Actuelle : " + ligneActuelle);

				var typeActuelle = $( "#" + id_element + " option:selected" ).data("type");
				console.log("Type Actuelle : " + typeActuelle);

				var montantActuelle = $( "#" + id_element + " option:selected" ).data("montant");
				console.log("Montant Actuelle : " + montantActuelle);
				
                if($("#" + id_element).val() != "0")
                {
                    nombreItems_apayer += 1;
                    $("#temps_aretenir" + ligneActuelle).val("1");
					$("#taux_aretenir" + ligneActuelle).val(montantActuelle);
					$("#montant_aretenir" + ligneActuelle).val(montantActuelle);
					
                }
                else nombreItems_apayer -= 1;
            }
        }
		
		function inputChangeAretenir(event)
        {
            $input = $(event.target); 
            var id_element = $input[0].id; //window.location.assign(""); //window.location.reload(true)
            console.log("ID ELEMENT : " + id_element);
			var ligneActuelle = $( "#" + id_element ).data("ligne");
			console.log("Ligne Actuelle : " + ligneActuelle);
			var temps = parseFloat($("#temps_aretenir" + ligneActuelle).val());
			console.log("Temps : " + temps);
			var taux = parseFloat($("#taux_aretenir" + ligneActuelle).val()).toFixed(2);
			console.log("Taux : " + taux);
			
            if(!isNaN(temps) && !isNaN(taux))
            {
                console.log("Is Float ");
				var montantActuelle = temps * taux ;
				montantActuelle = parseFloat(montantActuelle).toFixed(2)
				$("#montant_aretenir" + ligneActuelle).val(montantActuelle);
            }
        }
		
        function supprimerApayer(indice) {
            nombreLignes_apayer--;
			compteur_apayer--;
            if($("#id_apayer" + indice).val() != "0")
            {
                bulletinLocal.supprimerApayer($("#id_apayer" + indice).val());
            }
            $("#ligne_apayer" + indice).remove();
        }
		
        function supprimerAretenir(indice) {
            nombreLignes_aretenir--;
			compteur_aretenir--;
            if($("#id_retenir" + indice).val() != "0")
            {
                bulletinLocal.supprimerAretenir($("#id_retenir" + indice).val());
            }
            $("#ligne_retenir" + indice).remove();
        }
		
		function renvoyerElementsApayer(compteur)
        {
			var ligne = "";
            for(var i = 0; i < lesElementsApayer.length; i++)
            {
                var element = lesElementsApayer[i];
				ligne += '<option data-ligne="' + compteur + '" data-categorie="' + element.categorie_element + '" data-type="' + element.type_element + '" data-montant="' + element.montant + '" value="' + element.id + '">' + element.designation + '</option>';
            }
            return ligne;
        }
		function renvoyerElementsAretenir(compteur)
        {
			var ligne = "";
            for(var i = 0; i < lesElementsAretenir.length; i++)
            {
                var element = lesElementsAretenir[i];
				ligne += '<option data-ligne="' + compteur + '" data-categorie="' + element.categorie_element + '" data-type="' + element.type_element + '" data-montant="' + element.montant + '" value="' + element.id + '">' + element.designation + '</option>';
            }
            return ligne;
        }
		
        function enregistrer_bulletin(){
            var canPost = true;
            var bulletin = {
                designation : "",
                devise_id : 0,
                employe_id : 0,
                lot_id : 0,
                receveur_id : 0,
                reference : "",
                type : "",
				periode : ""
            };
            var items_apayer = new Array();
			var items_aretenir = new Array();
			
			//Pour les elements à payer
            for(var i = 1; i <= compteur_apayer; i++)
            {
                var elementApayer = document.getElementById("apayer" + i);
                if(elementApayer != null)
                {
                    var item = {
                        ligne_id : new Date().getTime() + "-" + i,
                        element_id : 0,
                        designation : "",
                        temps : 0,
                        taux : 0,
                        montant : 0,
                        type_element : 0,
						categorie_element : 0,
						type : "",
                    };
                    if($("#id_apayer" + i).val() != "0") item.ligne_id = $("#id_apayer" + i).val();
    
                    if($("#apayer" + i).val() != "0") 
                    {
						item.element_id = $("#apayer" + i).val();
						item.designation = $("#apayer" + i + " option:selected" ).text();
						item.temps = $("#temps_apayer" + i).val();
						item.taux = $("#taux_apayer" + i).val();						
						item.montant = $("#montant_apayer" + i).val();
						item.categorie_element = $("#apayer" + i  + " option:selected" ).data("categorie");
						item.type_element = $("#apayer" + i  + " option:selected" ).data("type");
                    }
                    else
                    {
                        canPost = false;
                        break;
                    }
                    items_apayer.push(item);
                }
            }
			
			//Pour les elements à retenir
            for(var i = 1; i <= compteur_aretenir; i++)
            {
                var elementAretenir = document.getElementById("aretenir" + i);
                if(elementAretenir != null)
                {
                    var item = {
                        ligne_id : new Date().getTime() + "-" + i,
                        element_id : 0,
                        designation : "",
                        temps : 0,
                        taux : 0,
                        montant : 0,
                        type_element : 0,
						categorie_element : 0,
						type : "",
                    };
                    if($("#id_aretenir" + i).val() != "0") item.ligne_id = $("#id_aretenir" + i).val();
    
                    if($("#aretenir" + i).val() != "0") 
                    {
						item.element_id = $("#aretenir" + i).val();
						item.designation = $("#aretenir" + i + " option:selected" ).text();
						item.temps = $("#temps_aretenir" + i).val();
						item.taux = $("#taux_aretenir" + i).val();						
						item.montant = $("#montant_aretenir" + i).val();
						item.categorie_element = $("#aretenir" + i + " option:selected" ).data("categorie");
						item.type_element = $("#aretenir" + i + " option:selected" ).data("type");
                    }
                    else
                    {
                        canPost = false;
                        break;
                    }
                    items_aretenir.push(item);
                }
            }
                
            if($("#designation_bulletin").val().length == 0) canPost = false;
            else bulletin.designation = $.trim($("#designation_bulletin").val());
   			
            if($("#employe_id").val() == "0") canPost = false;
            else bulletin.employe_id = $("#employe_id").val();
			
            if($("#lot_id").val() == "0") canPost = false;
            else bulletin.lot_id = $("#lot_id").val();

            if($("#devise_id").val() == "0") canPost = false;
            else bulletin.devise_id = $("#devise_id").val();
			
            bulletin.type = $("#type_bulletin").val();			
            bulletin.periode = $("#periode_bulletin").val();            
            bulletin.reference = $("#reference_bulletin").val();
            
            if(canPost == true)
            {
                $.each(items_apayer, function(i, ligne){
                    bulletinLocal.ajouterElementApayer(ligne);
                });
				$.each(items_aretenir, function(i, ligne){
                    bulletinLocal.ajouterElementAretenir(ligne);
                });
                bulletinLocal.ajouterBulletin(bulletin);
            }
            //document.getElementById('submit').click();
        }
	</script>
{% endblock %}
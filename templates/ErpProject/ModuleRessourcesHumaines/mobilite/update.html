{% extends "ErpProject/ModuleRessourceshumaines/shared/layout.html" %} {% block page %}
<div class="row">
    <ul class="breadcrumb">
        <li><a><span class="mif-home"></span></a></li>
        <li><a class="chargement-au-click" href="{% url 'module_rh_tableau_de_bord' %}">Module Ressources Humaines</a></li>
        <li><a class="chargement-au-click" href="{% url 'module_ressourceshumaines_list_mobilite' %}">Liste des Mobilités internes</a></li>
        <li>{{ title }}</li>
    </ul>
</div>

<div class="row">
    <div class="col-lg-12">
        <h2>Modifier Mobilite</h2>
        <strong style="float: right;color: grey;opacity: 0.4;margin-top: -30px;">{% now "jS F Y H:i" %}</strong>
            
        <div class="separ" style="background-color: grey;opacity: 0.2"></div>
            
        <div class="panel panel-default" style="border: none; margin-top: 1rem;">
            <div class="panel panel-body" style="background-color:#f5f5f5;border: none;border-radius: none;">
                

                <div class="row only-on-small-screen">
                    <h2 class="text-light no-margin-left">{{ title }}</h2>
                </div>


                <div class="row only-on-large-screen">
                    <button onclick="javascript:document.getElementById('submit').click()"  class="theme-btn theme-btn-sm rounded primary_color_{{module.name|lower}}" style="width: 20%;">
                        Valider
                    </button>
                    <button onclick="javascript:window.location.assign('{% url 'module_ressourceshumaines_list_mobilite' %}')"  class="theme-btn theme-btn-sm rounded primary_color_{{module.name|lower}}" style="width: 20%;margin-left: 5px">Annuler</button>
                </div>
                <div class="row only-on-small-screen">
                    <button onclick="javascript:document.getElementById('submit').click()" class="button large-button rounded primary">Valider</button>
                    <button onclick="javascript:window.location.assign('{% url 'module_ressourceshumaines_list_mobilite' %}')" class="button large-button rounded chargement-au-click" style="margin-left: 5px">Annuler</button>
                </div>

                <hr class="hr-ligne">

                {% include 'ErpProject/ErpBackOffice/widget/message.html' with messages=messages only %}
            <form id="form" method="POST" action="{% url 'module_ressourceshumaines_post_update_mobilite' %}" data-role="validator" data-show-required-state="false" data-hint-mode="line" data-hint-background="bg-red" data-hint-color="fg-white" data-hide-error="5000" novalidate="novalidate"
                            data-on-error-input="notifyOnErrorInput" data-show-error-hint="false">
                            {% csrf_token %}
                            <input id="submit" type="submit" style="display: none">
                             <input name="ref" type="hidden" value="{{ model.id }}">
                            <div class="row">
                    
                <div class="col-md-6">
                            <label>Direction</label>
                            <div class="input-control text full-size" data-role="input">
                                <input name="direction" id="direction" type="text" data-validate-func="required" data-validate-hint="Entrez direction !" value = "{{model.direction}}">
                            </div>
                </div>


            
                <div class="col-md-6">
                    <label>Service</label>
                    <div class="input-control text full-size">
                        <select  onchange="fill_account()" id="service" name="service"
                            
                            data-validate-arg="1"
                            data-validate-hint="Sélectionnez un departement svp">
                              <option value="{{model.service}}">{{model.service}}</option>
                                {% for item in services %}
                                    <option value="{{ item.libelle }}"> {{ item.libelle }} </option>
                                {% endfor %}

                        </select>
                    </div>
                </div>
                <div class="col-md-6">
                    <label>Type de Mobilité</label>
                    <div class="input-control text full-size" data-role="input">
                        <select name="type_mobilite" class="chosen-select" id="type_mobilite"
                        data-validate-func="required" data-validate-arg="1" data-validate-hint="Selectionnez une categorie svp.">
                                    <option value="{{model.type_mobilite}}">{{model.type_mobilite}}</option>
                                    <option value="Promotion">Promotion</option>
                                    <option value="Recrutement Interne">Recrutement Interne</option>

                        </select>
                    </div>
                </div>
                <div class="col-md-6">
                            <label>Fonctions_occupees</label>
                            <div class="input-control text full-size" data-role="input">
                                <input name="fonctions_occupees" id="fonctions_occupees" type="text" data-validate-func="required" data-validate-hint="Entrez fonctions_occupees !" value = "{{model.fonctions_occupees}}">
                            </div>
                </div>
                <div class="col-md-6">
                    <label>Postes occupées</label>
                    <div class="input-control text full-size" data-role="input">
                        <select  id="fonctions_occupees" name="fonctions_occupees"
                          
                            data-validate-arg="1"
                            data-validate-hint="Sélectionnez un poste svp">
                            <option value="{{model.fonctions_occupees}}">{{model.fonctions_occupees}}</option>

                        </select>
                        <!-- <input name="fonctions_occupees" id="fonctions_occupees" type="text" data-validate-func="required" data-validate-hint="Entrez fonctions_occupees !"> -->

                    </div>

                </div>
            
                <input type="hidden" name="categorie_socia_pro_precedent" value="{{model.categorie_socio_professionnelle}}">
                <div class="col-md-6">
                    <label>Categorie socio professionnelle</label>
                    <div class="input-control text full-size" data-role="input">
                        <select name="categorie_socio_professionnelle" class="chosen-select" id="categorie_socio_professionnelle"
                        data-validate-func="required" data-validate-arg="1" data-validate-hint="Selectionnez une categorie svp.">
                                    <option value="{{model.categorie_socio_professionnelle}}">{{model.categorie_socio_professionnelle}}</option>
                                    <option value="A"> A </option>
                                    <option value="B"> B </option>
                                    <option value="C"> C </option>
                                    <option value="D"> D </option>
                                    <option value="E"> E </option>
                                    <option value="F"> F </option>
                        </select>
                    </div>
                </div>
            
                <div class="col-md-6">
                            <label>Modalites</label>
                            <div class="input-control text full-size" data-role="input">
                                <input name="modalites" id="modalites" type="text" data-validate-func="required" data-validate-hint="Entrez modalites !" value = "{{model.modalites}}">
                            </div>
                </div>
            

                <div class="col-md-6">
                    <label>Date sortie</label>
                    <div id="date_entree" class="input-control text full-size"  data-format="dd/mm/yyyy" data-role="datepicker" data-locale="fr">
                        <input value="{{model.date_entree|date:"d/m/Y" }}" readonly type="text" name="date_entree" readonly
                            data-validate-func="required"
                            data-validate-hint="Precisez date_entree svp.">
                        <div class="button"><span class="mif-calendar"></span></div>
                    </div>
                </div>
 
                <div class="col-md-6">
                    <label>Date sortie</label>
                    <div id="date_sortie" class="input-control text full-size"  data-format="dd/mm/yyyy" data-role="datepicker" data-locale="fr">
                        <input value="{{model.date_sortie|date:"d/m/Y"}}" readonly type="text" name="date_sortie" readonly
                            data-validate-func="required"
                            data-validate-hint="Precisez date_sortie svp.">
                        <div class="button"><span class="mif-calendar"></span></div>
                    </div>
                </div>



            
                <div class="col-md-6">
                            <label>Employe_id</label>
                            <div class="input-control text full-size" data-role="input">
                                <input name="employe_id" id="employe_id" type="text" data-validate-func="required" data-validate-hint="Entrez employe_id !" value = "{{model.employe_id}}">
                            </div>
                </div>
            
        </div>
        </form>
    </div>
        </div>
    </div>
    <!-- /.col-lg-12 -->
</div>
<script>
    var lespostesfill = new Array();
    var lesemployeesfill = new Array();
    function fill_account() {

        var choixDepartement = $("#service").val();

        //$("#service_ref_id").children().remove();
        //$("#service_ref_id").append("<option value='"+choixDepartement+"'>"+textchoixDepartement+"</option>");

        console.log(choixDepartement)

        if ((choixDepartement !== 0) || (choixDepartement !== -100)){
            showDialog("chargement");
            console.log(choixDepartement)

            $.get(
                "{% url 'module_rh_get_poste_of_departement' %}",
                {ref:choixDepartement}
                ,
                function (response) {
                    console.log(response)
                    $("#fonctions_occupees").children().remove();
                    $("#fonctions_occupees").append("<option value='0'>Sélectionnez un poste</option>");
                        lespostesfill = [];
                        thereponse = response[0];
                        console.log(thereponse);
                        for (var i = 0; i < thereponse.length; i++) {
                            var unposte = thereponse[i];
                            lespostesfill.push({id:unposte.id, designation: unposte.designation});

                            var option = "<option value='" + unposte.id + "'>"+unposte.designation+"</option>";
                            $("#fonctions_occupees").append(option);
                        }
                    showDialog("chargement");
                },
                "json"
            );

        }
    }
</script>
    
{% endblock %}
{% extends "ErpProject/ModuleInventaire/shared/layout.html" %}
{% block page %}
{%load static %}
<div class="row">
    <ul class="breadcrumb">
        <li><a><span class="mif-home"></span></a></li>
        <li><a class="chargement-au-click" href="{% url 'module_inventaire_tableau_de_bord' %}">Module Inventaire</a>
        </li>
        <li><a class="chargement-au-click" href="{% url 'module_inventaire_list_traitement_immobilisation' %}">Liste des
                traitements</a></li>
        <li>{{ title }}</li>
    </ul>
</div>

<div class="row">
    <div class="col-lg-12">
        <h2>{{ title }}</h2>
        <strong style="float: right;color: grey;opacity: 0.4;margin-top: -30px;">{% now "jS F Y H:i" %}</strong>

        <div class="separ" style="background-color: grey;opacity: 0.2"></div>

        <!-- GESTION DU WORKFLOW -->
        {% include 'ErpProject/ErpBackOffice/widget/workflow.html' with utilisateur=utilisateur model=model content_type_id=content_type_id historique=historique roles=roles etapes_suivantes=etapes_suivantes url_add="module_inventaire_add_traitement_immobilisation" url_detail="module_inventaire_detail_traitement_immobilisation" csrf_token=csrf_token module=module type_doc="Traitement Immobilisation" only %}
        <!--FIN GESTION DU WORKFLOW-->

        {% include 'ErpProject/ErpBackOffice/widget/message.html' with messages=messages only %}
        <div   class="panel panel-default" style="border: none;">
            <div class="panel panel-body" style="background-color:#f5f5f5;border: none;border-radius: none;">
                <div id="TraiteImmobilisationPrint">
                    <div class="row only-on-small-screen">
                        <h2 class="text-light no-margin-left">{{ title }}</h2>
                    </div>
                    <!--div class="row only-on-large-screen">
                        <button onclick="javascript:window.location.assign('{% url 'module_inventaire_update_traitement_immobilisation' model.id %}')" class="button  rounded primary_color_{{module.name|lower}}">
                            Modifier
                        </button>
                        <button onclick="javascript:window.location.assign('{% url 'module_inventaire_list_traitement_immobilisation' %}')" class="button  rounded chargement-au-click" style="margin-left: 5px">Annuler</button>
                    </!div-->
                    <hr class="hr-ligne">

                    <div class="row item-content" style="margin-top: 0px">

                        <div class="col-md-6">
                            {% include 'ErpProject/ErpBackOffice/widget/organisation.html' %}
                        </div>
                        <div class="col-md-6" style="text-align: right;">
                            <h3>Traitement d'immobilisation</h3>
                            <h4 style="margin-bottom: 17px">{{model.value_type_traitement}}</h4>
                            <!-- Impression -->
                            <form method="POST" action="{% url 'back_office_print_objet' %}">
                                {% csrf_token %}
                                <input type="hidden" name="id" value={{model.id}}>
                                <input type="hidden" name="dao" value="print_traitement_immobilisation(id)">
                                <input type="hidden" name="previous" value="{{ request.path }}">
                                <button type="submit" class="btn btn-default" style="background-color: #41435d;border:none;color: white;">Imprimer</button>
                            </form>
                            <!-- Fin impression -->
                            <h3 style="color: red; font-weight: bold">N° {{model.numero_traitement}}</h3>
                        </div>



                        <p>
                            <div class="col-md-6">
                                Numero traitement :
                                <br>
                                <span class="sub-alt-header">{{ model.numero_traitement }}</span>
                                <br>
                                <br>
                            </div>
                            <div class="col-md-6">
                                Type de traitement :
                                <br>
                                <span class="sub-alt-header">{{ model.value_type_traitement }}</span>
                                <br>
                                <br>
                            </div>
                            <div class="col-md-6">
                                Date :
                                <br>
                                <span class="sub-alt-header">{{ model.created_at }}</span>
                                <br>
                                <br>
                            </div>
                            <div class="col-md-6">

                                Description :
                                <br>
                                <span class="sub-alt-header">{{ model.description }}</span>
                                <br>
                                <br>
                        </p>

                        </p>
                    </div>


                    <div class="row">
                        <div class="col-md-12">
                            <p class="sub-header"></p>
                            <table class="table border bordered">
                                <thead>
                                    <tr>
                                        <th width="15%">Immobilisation</th>
                                        <th width="16%">Immobilier</th>
                                        <th width="16%">Article</th>
                                        <th width="20%">Objet</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for ligne in lignes_traitements %}
                                    <tr class="table bordered border">
                                        <td> <a class="lien chargement-au-click"
                                                href="{% url 'module_inventaire_details_immobilisation' ligne.immobilisation_id %}">{{ ligne.immobilisation.code }}</a>
                                        </td>
                                        <td> {{ ligne.immobilisation.immobilier.numero_identification }}</td>
                                        <td> {{ ligne.immobilisation.immobilier.article.designation }}</td>
                                        <td> {{ ligne.description }}</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <br><br><br><br>
                    <div class="col-md-12" style="margin-bottom: 15px">

                        <h2>Documents attachés</h2>
                        <hr>
                        <ol>
                            {% for item in documents %}
                            <li style="margin-bottom: 0.25em">
                                <a href="/static{{item.url_document}}"> <span class="fa fa-file"></span>
                                    <span>{{item.description}} </span> </a>
                            </li>
                            {% endfor %}
                        </ol>
                    </div>
                </div>
            </div>
        </div>
<!-- Print Info -->
<button type="button" id="lancermodal" data-toggle="modal" data-target="#monmodal" style="display: none;">executer</button>
<div id="monmodal" class="modal fade" role="dialog">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-body">
                <center>
                    <iframe id="iframemodal" frameborder="0" style="width: 100%;" height="600px"></iframe>
                </center>
                <hr>
                <center>
                    <button type="button" class="btn btn-danger" data-dismiss="modal">FERMER</button>
                </center>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript" src="{% static 'ErpProject/js/pdf/print.min.js' %}"></script>
<script type="text/javascript" src="{% static 'ErpProject/js/pdf/libs/jspdf.debug.js' %}"></script>
<script type="text/javascript" src="{% static 'ErpProject/js/pdf/libs/cell.js' %}"></script>
<script type="text/javascript" src="{% static 'ErpProject/js/pdf/libs/jspdf.plugin.autotable.min.js' %}"></script>
<script type="text/javascript" src="{% static 'ErpProject/js/pdf/libs/from_html.js' %}"></script>
<script type="text/javascript" src="{% static 'ErpProject/js/pdf/libs/html2canvas.min.js' %}"></script>
<!-- Print Document Function -->
<script>
function printScreen() {
    const filename = 'Traitement immobilisation.pdf';
    var pdf = new jsPDF('l', 'pt', 'ledger');

    pdf.html($('#TraiteImmobilisationPrint')[0], {
        callback: function (pdf) {
            var string = pdf.output('datauristring');
            $('#iframemodal').attr('src', string);
            $('#lancermodal').click();
        }
    });

    margins = {
        top: 0,
        bottom: 0,
        left: 0,
        width: 0
    };
}
</script>
{% endblock %}
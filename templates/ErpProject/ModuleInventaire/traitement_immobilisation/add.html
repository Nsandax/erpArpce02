{% extends "ErpProject/ModuleInventaire/shared/layout.html" %} {% block page %}
<div class="row">
    <ul class="breadcrumb">
        <li><a><span class="mif-home"></span></a></li>
        <li><a class="chargement-au-click" href="{% url 'module_inventaire_tableau_de_bord' %}">Module Inventaire</a></li>
        <li><a class="chargement-au-click" href="{% url 'module_inventaire_list_traitement_immobilisation' %}">Liste des traitements</a></li>
        <li>{{ title }}</li>
    </ul>
</div>

<div class="row">
    <div class="col-lg-12">
        <h2>{{ title }}</h2>
        <strong style="float: right;color: grey;opacity: 0.4;margin-top: -30px;">{% now "jS F Y H:i" %}</strong>

        <div class="separ" style="background-color: grey;opacity: 0.2"></div>

        <div class="panel panel-default" style="border: none; margin-top: 1rem;">
            <div class="panel panel-body" style="background-color:#f5f5f5;border: none;border-radius: none;">


                <div class="row only-on-small-screen">
                    <h2 class="text-light no-margin-left">{{ title }}</h2>
                </div>
                <!-- <div class="row only-on-large-screen">
                    <button onclick="javascript:document.getElementById('submit').click()"
                    class="theme-btn theme-btn-sm rounded primary_color_{{module.name|lower}} chargement-au-click primary_color_{{ module.name|lower }}">
                        Valider
                    </button>
                    <button onclick="javascript:window.location.assign('{% url 'module_inventaire_list_traitement_immobilisation' %}')"
                     class="theme-btn theme-btn-sm rounded chargement-au-click" style="margin-left: 5px">Annuler</button>
                </div>
                <div class="row only-on-small-screen">
                    <button onclick="javascript:document.getElementById('submit').click()" class="button large-button rounded primary">Valider</button>
                    <button onclick="javascript:window.location.assign('{% url 'module_inventaire_list_traitement_immobilisation' %}')" class="button large-button rounded chargement-au-click" style="margin-left: 5px">Annuler</button>
                </div> -->
                <div class="row">
                    <div class="col-md-2">
                        {% include 'ErpProject/ErpBackOffice/widget/submitButton.html' with  id="btnSubmit"  val="Valider"%}
                    </div>
                    <div class="col-md-2">
                        <button style="width: 100%;" onclick="javascript:window.location.assign('{% url 'module_inventaire_list_traitement_immobilisation' %}')" class="theme-btn theme-btn-sm rounded">
                            Annuler
                        </button>
                    </div>
                </div>


                <hr class="hr-ligne">

                {% include 'ErpProject/ErpBackOffice/widget/message.html' with messages=messages only %}
            <form id="form" method="POST" action="{% url 'module_inventaire_post_add_traitement_immobilisation' %}" data-role="validator" data-show-required-state="false" data-hint-mode="line" data-hint-background="bg-red" data-hint-color="fg-white" data-hide-error="5000" novalidate="novalidate"
                    data-on-error-input="notifyOnErrorInput" data-show-error-hint="false"  enctype="multipart/form-data"
                    >
                    {% csrf_token %}
                    <input id="submit" type="submit" style="display: none">
                    <div class="row">

                <div class="col-md-6">
                    <label>Numéro de traitement</label>
                    <div class="input-control text full-size" data-role="input">
                        <!-- <input name="numero_traitement" id="numero_traitement" type="text" data-validate-func="required" data-validate-hint="Entrez numero_traitement !"> -->
                        <input name="numero_traitement" id="numero_traitement" type="text" disabled>
                    </div>
                </div>

                <div class="col-md-6">
                    <label>Rapport d'inventaire</label>
                    <div class="input-control text full-size">
                        <input id="file_upload" name="file_upload" type="file">
                    </div>
                </div>

                <div class="col-md-6">
                            <label>Description</label>
                            <div class="input-control text full-size" data-role="input">
                                <input name="description" id="description" type="text" data-validate-func="required" data-validate-hint="Entrez description !">
                            </div>

                </div>
                <div class="col-md-6">
                    <label>Type de traitement</label>
                <div class="input-control select full-size">
                    <select name="typeTraitement"
                        data-validate-func="min"
                        data-validate-arg="1"
                        data-validate-hint="Sélectionnez un type de traitement">
                        <option value="">Selectionnez un type de traitement</option>
                        <option value="1">Cession d'immobilisation</option>
                        <option value="2">Mise au rebut d'immobilisation</option>


                    </select>
                </div>
            </div>

        </div>
        <br>
        <br>
        <hr class="att-ligne" style="background-color: #4d4a4a; height:3px; margin-top:10px">
        <div class="row margin20 no-margin-left no-margin-right">
            <table class="table no-margin">
                <thead class="no-border">
                    <tr>
                        <th width="45%">Immobilisation</th>
                        <th width="20%">Objet</th>
                        <th width="5%"></th>
                    </tr>
                </thead>
                <tbody id="items">
                    <tr id="ligne1">
                        <td class="no-padding-top no-padding-left no-padding-bottom">
                           <div class="input-control select full-size">
                                <select id="immobilisation1" name="immobilisation"
                                    data-validate-func="min"
                                    data-validate-arg="1"
                                    data-validate-hint="Sélectionnez une immobilisation">
                                    <option value="">Sélectionnez une immobilisation</option>
                                    {% for item in immobilisations %}
                                        <option value="{{ item.id }}"> {{ item.code }} {{ item.immobilier.numero_traitement }} {{item.immobilier.article.designation}} </option>
                                    {% endfor %}

                                </select>
                            </div>
                        </td>
                        <td class="no-padding-top no-padding-bottom">
                            <div class="input-control text full-size">
                                <input name="description" id="description1" type="text" autocomplete="off" >
                            </div>
                        </td>
                        <td class="no-padding-top no-padding-bottom">
                            <div class="pagination no-border">
                                <span class="item" title="Supprimer la ligne" onclick="supprimerLigne(1)"><span class="mif-cross fg-red"></span></span>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="row margin10 no-margin-left no-margin-right">
            <button type="button" class="button small-button rounded" id="btnAjouterLigne">Ajouter une ligne</button>
        </div>
        </form>
    </div>
        </div>
    </div>
    <!-- /.col-lg-12 -->
</div>

<script>
    var lataille = 1;
        var nombreLignes = 1;
        var nombreItems = 0;
        var ligneActuelle = 0;
        var compteur = 1;
        var bon = {};


        $("#btnAjouterLigne").on("click", function () {
            nombreLignes++;
            compteur++;
            var nouvelleLigne = '<tr id="ligne' + compteur + '"><td class="no-padding-top no-padding-left no-padding-bottom">';
            nouvelleLigne += ' <div class="input-control select full-size"><select id="immobilisation' + compteur +'" name="immobilisation" ';
            nouvelleLigne += 'data-validate-func="min"  data-validate-arg="1" data-validate-hint="Sélectionnez une immobilisation"> ';
            nouvelleLigne += '<option value="">Sélectionnez une immobilisation</option> {% for item in immobilisations %} ';
            nouvelleLigne += '<option value="{{ item.id }}"> {{ item.code }} {{ item.immobilier.numero_traitement }} {{item.immobilier.article.designation}} </option>';
            nouvelleLigne += '{% endfor %}</select> </div></td>';

            nouvelleLigne += '<td class="no-padding-top no-padding-bottom">';
            nouvelleLigne += '<div class="input-control text full-size">';
            nouvelleLigne += '<input id="description' + compteur + '" name="description" type="text">';
            nouvelleLigne += '</span></div>';
            nouvelleLigne += '</td><td class="no-padding-top no-padding-bottom"><div class="pagination no-border">';
            nouvelleLigne += '<span class="item" title="Supprimer la ligne" onclick="supprimerLigne(' + compteur + ')"><span class="mif-cross fg-red"></span></span>';
            nouvelleLigne += '</div></td></tr>';

            $("#items").append(nouvelleLigne);
        });


        function supprimerLigne(indice) {
            nombreLignes--;
            $("#ligne" + indice).remove();
        }

    </script>

{% endblock %}
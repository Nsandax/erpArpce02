{% extends "ErpProject/ModuleInventaire/shared/layout.html" %} {% block page %}
{%load static %} {% load humanize %} {% load inventaire_filter %}{% load calculatrice %}
<div class="row" style="padding-top: 30px;">
    <div class="col-lg-12">
        <h2>{{ title }}</h2>
        <strong style="float: right;color: grey;opacity: 0.4;margin-top: -30px;">{% now "jS F Y H:i" %}</strong>
        <div class="separ" style="background-color: grey;opacity: 0.2"></div>
        <br>
        <div class="panel panel-default" style="border: none;">
            <div class="panel panel-body" style="background-color:white;">
                <div class="col-md-12">
                    <div class="col-md-12">
                        <h3><center><strong>{{title}} {%if empl %} {{empl.designation}} {% endif %}</strong></center></h3>
                    </div>
                    <div class="col-md-6">
                        {% include 'ErpProject/ErpBackOffice/widget/organisation.html' %}
                    </div>
                    <div class="col-md-6" style="text-align: right;">
                        <form action="{% url 'module_inventaire_post_article_in_stock' %}" method="POST">
                            {% csrf_token %}
                            <input name="emplacement_origine_id" type="hidden" value="{{emplacement_origine_id}}">
                            <input name="inventaire_de" type="hidden" value="{{inventaire_de}}">
                            <input name="categorie_id" type="hidden" value="{{categorie_id}}">
                            <input name="article_id" type="hidden" value="{{article_id}}">
                            <input name="print" type="number" value="1" style="display:none">
                            <button type="submit" class="btn btn-default" style="background-color: #41435d;border:none;color: white;">
                                Imprimer
                            </button>
                        </form>
                    </div>
                    <div class="separ col-md-12" style="background-color: grey;opacity: 0.1;margin-bottom: 20px;"></div>
                    <div class="col-md-12">
                        <table class="display nowrap border bordered striped" cellspacing="0" style="width: 100%;">
                            <tr style="text-align:center;">
                                <td class="head"></td>
                                <td class="head">Article</td>
                                <td class="head">Quantité</td>
                                <td class="head">Unité de mesure</td>
                                <td class="head">Lieu</td>
                                <td class="head">Numéro de série</td>
                                <td class="head">Valeur d'inventaire</td>
                            </tr>
                                {% for item in model %}
                                    {% if item.stockage != None %}
                                        <tr class="tr-toggle main" id="{{ item.article.id }}" style="background-color:#DCDDFB;font-weight:700!important;text-align:center;" data-toggle="collapse" data-target=".article{{ item.article.id }}" daria-expanded="false">
                                            <td class="td"><i class="fa fa-caret-right"></i></td>
                                            <td class="td">{{ item.article.designation }}</td>
                                            <!-- <td ></td> -->
                                            <td class="td"> {% if emplacement == 0 %}{{ item.article.disponible | sep_float }}{% else %} {{item.qte | sep_float }} {% endif %} </td>
                                            <td class="td">{{ item.article.unite.designation }}</td>
                                            <td colspan="2" class="td"></td>

                                            <td class="td"> {% if emplacement == 0 %}{{ item.article.valeur_inventaire | sep_float }}{% else %}{{item.val_inventaire | sep_float}}{% endif %} </td>
                                        </tr>

                                        {% for item2 in item.stockage %}

                                            {% if item2.quantite_disponible != 0  %}
                                                <tr class="tr-toggle collapse article{{ item.article.id }}" style="background-color:#d8d6d6;font-weight:700!important;text-align:center;" data-toggle="collapse" data-target=".stockage{{ item2.id }}" daria-expanded="false">
                                                    <td class="td"><span style="margin-left: 10px;"><i class="fa fa-caret-right icon{{ item.article.id }}"></i></span></td>
                                                    <td class="td">{{item2.emplacement.designation}}</td>
                                                    <td class="td">{{ item2.quantite_disponible | sep_float }} </td>
                                                    <td class="td"> </td>
                                                    <td class="td"></td>
                                                    <td class="td"></td>
                                                    <td class="td">{% multiply item2.quantite_disponible item.article.prix_unitaire %}</td>
                                                </tr>
                                                {% if item.article.checkAsset == True %}
                                                    {% for item3 in item2.series_emplacement %}
                                                        <tr class="collapse stockage{{ item2.id }} main{{ item.article.id }}" style="text-align:center;">
                                                            <td class="td"></td>
                                                            <td class="td">{{ item2.article.designation }} </td>
                                                            <td class="td" style="text-align: center" >1.0</td>
                                                            <td class="td">{{ item.article.unite.designation }}</td>
                                                            <td class="td">{{ item3.emplacement.designation }}</td>
                                                            <td class="td">{{ item3.numero_identification }}</td>
                                                            <td class="td" style="text-align: center" >{{ item3.article.prix_unitaire | sep_float  }}</td>
                                                        </tr>
                                                    {% endfor %}
                                                {% else %}
                                                    <tr class="collapse stockage{{ item2.id }} main{{ item.article.id }}" style="text-align:center;">
                                                        <td class="td"></td>
                                                        <td class="td">{{ item2.article.designation }} </td>
                                                        <td class="td" style="text-align: center" >{{ item2.quantite_disponible | sep_float }}</td>
                                                        <td class="td">{{ item.article.unite.designation }}</td>
                                                        <td class="td">{{ item2.emplacement.reference }}</td>
                                                        <td class="td"></td>
                                                        <td class="td" style="text-align: center" >{% multiply item2.quantite_disponible item.article.prix_unitaire %}</td>
                                                    </tr>
                                                {% endif %}
                                            {% endif %}

                                        {% endfor %}
                                    {% endif %}
                                {% endfor %}
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>

    $(document).ready(function(){

        $("tr > td > i").removeClass("fa-caret-down");
        $("tr > td > i").addClass("fa-caret-right");
        $("tr > td > i").data("show", false);

        $(".tr-toggle").click(function() {
            var icone = $(this).find("i");
            if (icone.data("show") === true) {
                icone.removeClass("fa-caret-down");
                icone.addClass("fa-caret-right");
                icone.data("show", false);

            } else {
                icone.removeClass("fa-caret-right");
                icone.addClass("fa-caret-down");
                icone.data("show", true);
            }
        });

        $(".main").click(function() {
            var icone = $(this).find("i");
            if (icone.data("show") === true) {

            }else {

                id = $(this).attr('id');

                el = $('.main'+id);
                el.removeClass('in');
                el.attr('aria-expanded','false');

                ic = $('.icon'+id);
                ic.removeClass("fa-caret-down");
                ic.addClass("fa-caret-right");
                ic.data("show", false);
            }
        });

    });
</script>

<script>

</script>

{% endblock %}

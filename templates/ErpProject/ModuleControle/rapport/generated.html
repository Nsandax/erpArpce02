{% extends "ErpProject/ModuleControle/shared/layout.html" %}
{% block page %}
{% load account_filters %} 
    <div class="row" style="padding-top: 30px">
        <p class="align-center header">{{ title }}</p>
        <div class="row">
            <p>
                Période :<br>
                <span class="sub-header">Du {{ date_debut }} au {{ date_fin }} </span>
                <br>
                <br>
                Devise :<br>
                <span class="sub-header">{{ devise.designation }}</span>
            </p>
        </div>
        <table class="table striped border bordered no-margin" style="width: 100%">
            <thead>
                <tr>
                    <th width="15%">Pièce comptable</th>
                    <th width="15%">Date</th>
                    <th width="30%">Libellé</th>
                    <th width="20%">Débit</th>
                    <th width="20%">Crédit</th>
                </tr>
            </thead>
        </table>
        {% for compte in comptes %}
            <div class="row padding10 no-margin">
                <p class="sub-header no-margin">Compte : {{ compte.numero }} {{ compte.designation }} </p>
            </div>
            <table class="table striped border bordered no-margin" style="width: 100%">
                <tbody>
                    {% for item in model %}
                        {% if item.compte_id == compte.id %}
                            <tr>
                                <td width="15%"> {% if item.piece_comptable != None %}{{ item.piece_comptable.designation }}{% endif %} </td>
                                <td width="15%"> {% if item.piece_comptable != None %}{{ item.piece_comptable.date_piece|date:"d/m/Y" }}{% endif %} </td>
                                <td width="30%"> {{ item.designation }} </td>
                                <td width="20%" align="right"> {% if item.debit != "0.00" %} {{ item.debit |monetary}} {% endif %} </td>
                                <td width="20%" align="right"> {% if item.credit != "0.00" %} {{ item.credit |monetary}} {% endif %} </td>
                            </tr>
                        {% endif %}
                    {% endfor %}
                </tbody>
            </table>
        {% endfor %}
        <table class="table striped border bordered no-margin" style="width: 100%">
            <tfoot>
                <tr>
                    <th width="15%"></th>
                    <th width="15%"></th>
                    <th width="30%"></th>
                    <th width="20%" id="equilibre_debit" style="text-align: right"></th>
                    <th width="20%" id="equilibre_credit" style="text-align: right"></th>
                </tr>
            </tfoot>
        </table>
    </div>
    <script>
        var equilibre_credit = 0;
        var equilibre_debit = 0;
        var devise = "";

        {% for item in model %}
            equilibre_debit += parseFloat("{{ item.debit }}");
            equilibre_credit += parseFloat("{{ item.credit }}");
        {% endfor %}

        $(document).ready(function(){
            $("#equilibre_credit").text(equilibre_credit.toFixed(2));
            $("#equilibre_debit").text(equilibre_debit.toFixed(2));
        });
    </script>
{% endblock %}
{% extends "ErpProject/ModuleControle/shared/layout.html" %} {% block page %} {% load account_filters %}
<div class="row">
    <ul class="breadcrumb">
        <li><a><span class="mif-home"></span></a></li>
        <li><a class="chargement-au-click" href="{% url 'module_controle_tableau' %}">Tableau de bord</a></li>
        <li><a class="chargement-au-click" href="{% url 'module_controle_list_centre_cout' %}">Liste des centre de coûts</a></li>
        <li><a class="chargement-au-click" href="{% url 'module_controle_detail_centre_cout' centre_cout.id %}">{{centre_cout.code}} {{centre_cout.designation}}</a></li>
        <li>{{ title }}</li>
    </ul>
</div>
{% include 'ErpProject/ErpBackOffice/widget/workflow.html' with utilisateur=utilisateur model=model content_type_id=content_type_id historique=historique roles=roles etapes_suivantes=etapes_suivantes url_add="module_controle_add_centre_cout" url_detail="module_controle_detail_centre_cout" csrf_token=csrf_token module=module type_doc="" only %}


<div class="row">
    <div class="col-lg-12">
        <h2>{{ title }}</h2>
        <strong style="float: right;color: grey;opacity: 0.4;margin-top: -30px;">{% now "jS F Y H:i" %}</strong>
            
        <div class="separ" style="background-color: grey;opacity: 0.2"></div>
            
        <div class="panel panel-default" style="border: none; margin-top: 1rem;">
            <div class="panel panel-body" style="background-color:#f5f5f5;border: none;border-radius: none;">

            <div class="row only-on-small-screen">
                    <h2 class="text-light no-margin-left">{{ title }}</h2>
                </div>

                <div class="panel" style="background-color:#f5f5f5;border: none;">
                    <div class="col-md-2" style="padding: 10px;">
                        <div class="mb-3 ">
                            <div class="card-body shadow" style="padding: 0px;background-color: white;">
                                <div  style="width: 100%;background-color: white;/*padding: 10px;">
                                    <div style="padding: 10px;"> 
                                        <strong class="sub-header" style="margin: 10px;font-weight: 900;">Charge</strong>
                                    </div>
                                    <div class="separ" style="background-color: grey;opacity: 0.2;height: 1px;margin-bottom: 10px;"></div>                                   
                                </div>
                                <div class="pt-4" style="padding: 15px;background-color: white;padding-top: 0px;padding-bottom: 0px;">
                                    <h2><span > {{ charge|monetary }}</span> {{ devise.symbole_devise}}</h2>                         
                                </div>
                                <div class="separ" style="background-color: grey;opacity: 0.2;height: 1px;margin-bottom: 10px;"></div>                               
                                <div class="primary_color_{{module.name|lower}}" style="height: 5px;"></div>                                             
                            </div>
                        </div>
                    </div>
                    <div class="col-md-2" style="padding: 10px;">
                        <div class="mb-3 ">
                            <div class="card-body shadow" style="padding: 0px;background-color: white;">
                                <div  style="width: 100%;background-color: white;/*padding: 10px;">
                                    <div style="padding: 10px;"> 
                                        <strong class="sub-header" style="margin: 10px;font-weight: 900;">Produit</strong>
                                    </div>
                                    <div class="separ" style="background-color: grey;opacity: 0.2;height: 1px;margin-bottom: 10px;"></div>                                   
                                </div>
                                <div class="pt-4" style="padding: 15px;background-color: white;padding-top: 0px;padding-bottom: 0px;">
                                    <h2><span > {{ produit|monetary }}</span> {{ devise.symbole_devise}}</h2>                         
                                </div>
                                <div class="separ" style="background-color: grey;opacity: 0.2;height: 1px;margin-bottom: 10px;"></div>                               
                                <div class="primary_color_{{module.name|lower}}" style="height: 5px;"></div>                                             
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3" style="padding: 10px;">
                        <div class="mb-3 ">
                            <div class="card-body shadow" style="padding: 0px;background-color: white;">
                                <div  style="width: 100%;background-color: white;/*padding: 10px;">
                                    <div style="padding: 10px;"> 
                                        <strong class="sub-header" style="margin: 10px;font-weight: 900;">Balance</strong>
                                    </div>
                                    <div class="separ" style="background-color: grey;opacity: 0.2;height: 1px;margin-bottom: 10px;"></div>                                   
                                </div>
                                <div class="pt-4" style="padding: 15px;background-color: white;padding-top: 0px;padding-bottom: 0px;">
                                    <h2><span > {{ balance |monetary}}</span> {{ devise.symbole_devise}}</h2>                         
                                </div>
                                <div class="separ" style="background-color: grey;opacity: 0.2;height: 1px;margin-bottom: 10px;"></div>                               
                                <div class="primary_color_{{module.name|lower}}" style="height: 5px;"></div>                                             
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3" style="padding: 10px;">
                        <div class="mb-3 ">
                            <div class="card-body shadow" style="padding: 0px;background-color: white;">
                                <div  style="width: 100%;background-color: white;/*padding: 10px;">
                                    <div style="padding: 10px;"> 
                                        <strong class="sub-header" style="margin: 10px;font-weight: 900;">Montant alloué (Budget)</strong>
                                    </div>
                                    <div class="separ" style="background-color: grey;opacity: 0.2;height: 1px;margin-bottom: 10px;"></div>                                   
                                </div>
                                <div class="pt-4" style="padding: 15px;background-color: white;padding-top: 0px;padding-bottom: 0px;">
                                    <h2><span class="monetary">{{ montant_alloue }}</span> {{ devise.symbole_devise}}</h2>                         
                                </div>
                                <div class="separ" style="background-color: grey;opacity: 0.2;height: 1px;margin-bottom: 10px;"></div>                               
                                <div class="primary_color_{{module.name|lower}}" style="height: 5px;"></div>                                             
                            </div>
                        </div>
                    </div>
                    <div class="col-md-2" style="padding: 10px;">
                        <div class="mb-3 ">
                            <div class="card-body shadow" style="padding: 0px;background-color: white;">
                                <div  style="width: 100%;background-color: white;/*padding: 10px;">
                                    <div style="padding: 10px;"> 
                                        <strong class="sub-header" style="margin: 10px;font-weight: 900;">% en consommation</strong>
                                    </div>
                                    <div class="separ" style="background-color: grey;opacity: 0.2;height: 1px;margin-bottom: 10px;"></div>                                   
                                </div>
                                <div class="pt-4" style="padding: 15px;background-color: white;padding-top: 0px;padding-bottom: 0px;">
                                    <h2>{{ pourcentage }} %</h2>                         
                                </div>
                                <div class="separ" style="background-color: grey;opacity: 0.2;height: 1px;margin-bottom: 10px;"></div>                               
                                <div class="primary_color_{{module.name|lower}}" style="height: 5px;"></div>                                             
                            </div>
                        </div>
                    </div>
        
                </div>


               

                {% include 'ErpProject/ErpBackOffice/widget/message.html' with messages=messages only %}
                <div class="row">
                            <div class="col-md-12">
                             
        
        <div class="row">
            <div class="col-md-12">
                <table class="table border bordered">
                    <thead>
                        <tr>
                            <th width="15%">Date</th>
                            <th width="10%">Libelle</th>
                            <th width="16%">Compte comptable</th>
                            <th width="8%">Centre de coût</th>
                            <th width="10%">Ligne bugdetaire</th>
                            <th width="8%">Type</th>
                            <th width="13%">Pièce comptable</th>
                            <th width="8%">Nature</th>
                            <th width="16%">Montant</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for ligne in ecritures_analytiques %}
                            <tr class="table bordered border">
                                <td> {{ ligne.created_at }}</td>
                                <td> {{ ligne.libelle }}</td>
                                <td> {{ ligne.compte }}</td>
                                <td><a class="lien chargement-au-click" href="{% url 'module_controle_detail_centre_cout' ligne.centre_cout_id %}"> {{ ligne.centre_cout.get_label }}</a></td>
                                            {% if ligne.ligne_budgetaire %}
                                            <td> <a class="lien chargement-au-click" href="{% url 'module_budget_detail_ligne_budgetaire' ligne.ligne_budgetaire.id %}">{{ ligne.ligne_budgetaire.code }}</a></td>
                                {% else %}
                                <td>Aucune</td>
                                {% endif %}
                                <td> {{ ligne.value_type }} </td>
                                {% if ligne.ecriture_comptable %}
                                <td> <a class="lien chargement-au-click" href="{% url 'module_comptabilite_details_piece' ligne.ecriture_comptable.piece_comptable_id %}">{{ ligne.ecriture_comptable.piece_comptable }}</a></td>
                                {% else %}
                                <td>Aucune</td>
                                {% endif %}
                                {# si le montant sur la ligne est negatif, il s'agit d'une charge sinon c'est un produit! Si c'est négatif on applique la valeur absolue, c'est ce que fait la fonction widthratio machin #}
                                {% if ligne.montant >= 0 %}
                                <td>Produit</td>
                                <td> {{ ligne.montant |monetary}} {{ ligne.devise.symbole_devise }}</td>
                                {% else %}
                                <td>Charge</td>
                                <td> {% widthratio ligne.montant 1 -1  %} {{ ligne.devise.symbole_devise }}</td>
                                {% endif %}                                
                                
                                
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

                                </div>
                            </div>              
                    
            
           {% endblock %}
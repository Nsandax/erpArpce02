{% extends "ErpProject/ModuleVente/shared/layout.html" %}
{% block page %}
{%load static %}
{% load humanize %}

<div class="row">
    <ul class="breadcrumb">
        <li><a><span class="mif-home"></span></a></li>
        <li><a class="leaf" href="{% url 'module_vente_tableau_de_bord' %}">Module Client</a></li>
        <li><a class="chargement-au-click" href="{% url 'module_vente_list_etat_facturation' %}">Liste des états de facturation</a></li>
        <li>{{ title }}</li>
    </ul>
</div>


<div class="row" style="padding-top: 30px;">
    <div class="col-lg-12">
        <h2>{{ title }}</h2>
        <strong style="float: right;color: grey;opacity: 0.4;margin-top: -30px;">{% now "jS F Y H:i" %}</strong>
        <div class="separ" style="background-color: grey;opacity: 0.2"></div>

        <!-- GESTION DU WORKFLOW -->
        {% include 'ErpProject/ErpBackOffice/widget/workflow.html' with utilisateur=utilisateur model=model content_type_id=content_type_id historique=historique roles=roles etapes_suivantes=etapes_suivantes url_add="module_vente_add_etat_facturation" url_detail="module_vente_details_etat_facturation" csrf_token=csrf_token module=module type_doc="Facture fournisseur" only %}
        <!--FIN GESTION DU WORKFLOW-->

        <br>
        <div class="col-md-2">
        <button  onclick="printScreen();" class="btn btn-default" style="background-color: #41435d;border:none;color: white;">Imprimer</button>
    </div>
        <br><br>
        <!-- Appel de la fonction message -->
    {% include 'ErpProject/ErpBackOffice/widget/message.html' with messages=messages only %}
        <div id="EtatFacturePrint" class="panel panel-default" style="border: none;">
            <div class="panel panel-body" style="background-color:white;">
                <div class="col-md-12">
                    <div class="col-md-6">
                        {% include 'ErpProject/ErpBackOffice/widget/organisation.html' %}
                    </div>
                    <div class="col-md-6" style="text-align: right;">
                        <h3>Etat de facturation</h3>

                        <!-- <form method="POST" action="{% url 'module_achat_expression_print' %}">
                            {% csrf_token %}
                            <input type="hidden" name="id" value={{model.id}}>

                        </form> -->

                        <h3 style="color: red; font-weight: bold">N° {{model.numero_etat_facturation}}</h3>

                    </div>
                    <div class="separ col-md-12" style="background-color: grey;opacity: 0.1;margin-bottom: 20px;"></div>
                    <div class="col-md-6">
                        <p>


                            <strong>Justification :</strong> {{model.description}}


                        </p>
                    </div>


                    <div class="col-md-6" style="margin-bottom: 40px">
                        <p style="float: right;"><strong>Date demande: {{model.date_etat | date:"d/m/Y" }}</strong> <br>
                            <strong>Statut demande : {{model.etat}}</strong> <br> <strong></p>
                    </div>

                </div>


                <div class="col-md-12" style="margin-bottom: 15px">

                    <h2>Documents attachés</h2>
                    <hr>
                    <ol>
                        {% for item in documents %}
                        <li style="margin-bottom: 0.25em">
                            <a href="/static{{item.url_document}}"> <span class="fa fa-file"></span>
                                <span>{{item.description}} </span> </a>
                        </li>
                        {% endfor %}
                    </ol>
                </div>

            </div>
        </div>
    </div>
</div>

<!-- Print Info -->
<button type="button" id="lancermodal" data-toggle="modal" data-target="#monmodal" style="display: none;">executer</button>
<div id="monmodal" class="modal fade" role="dialog">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-body">
                <center>
                    <iframe id="iframemodal" frameborder="0" style="width: 100%;" height="600px"></iframe>
                </center>
                <hr>
                <center>
                    <button type="button" class="btn btn-danger" data-dismiss="modal">FERMER</button>
                </center>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript" src="{% static 'ErpProject/js/pdf/print.min.js' %}"></script>
<script type="text/javascript" src="{% static 'ErpProject/js/pdf/libs/jspdf.debug.js' %}"></script>
<script type="text/javascript" src="{% static 'ErpProject/js/pdf/libs/cell.js' %}"></script>
<script type="text/javascript" src="{% static 'ErpProject/js/pdf/libs/jspdf.plugin.autotable.min.js' %}"></script>
<script type="text/javascript" src="{% static 'ErpProject/js/pdf/libs/from_html.js' %}"></script>
<script type="text/javascript" src="{% static 'ErpProject/js/pdf/libs/html2canvas.min.js' %}"></script>
<!-- Print Document Function -->
<script>
function printScreen() {
    const filename = 'Etat de facturation.pdf';
    var pdf = new jsPDF('l', 'pt', 'ledger');

    pdf.html($('#EtatFacturePrint')[0], {
        callback: function (pdf) {
            var string = pdf.output('datauristring');
            $('#iframemodal').attr('src', string);
            $('#lancermodal').click();
        }
    });

    margins = {
        top: 0,
        bottom: 0,
        left: 0,
        width: 0
    };
}
</script>



{% endblock %}
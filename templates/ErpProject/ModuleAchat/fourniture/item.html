{% extends "ErpProject/ModuleAchat/shared/layout.html" %} {% block page %}{% load humanize %}
{% load account_filters %} 
<div class="row">
    <ul class="breadcrumb">
        <li><a><span class="mif-home"></span></a></li>
        <li><a class="chargement-au-click" href="{% url 'module_achat_home' %}">Module Achat</a></li>
        <li><a class="chargement-au-click" href="{% url 'module_achat_list_fournitures' %}">Liste des fournitures</a></li>
        <li>{{ title }}</li>
    </ul>
</div>
<div class="row">
    {% if model.numero == None or model.numero == "" %}
    <button onclick="javascript:window.location.assign('{% url 'module_achat_add_fourniture' %}')" class="button small-button rounded chargement-au-click" style="margin-left: 5px">Modifier</button> {% else %}
    <button onclick="javascript:imprimer()" class="button small-button rounded primary_color_{{module.name|lower}} chargement-au-click" style="margin-left: 5px">Imprimer</button> {% endif %}
</div>

<hr class="hr-ligne" />

<div class="row item-content" style="margin-top: 20px" id="content_bon">
    <div class="cell padding30 shadow">
        <center>
            <h4>Fourniture liée au bon d'achat N°{{ model.numero }}</h4>
        </center>
        {% if model.est_realisee %}
        <div class="row">
            <p class="minor-header fg-gray">
                Achat réalisé à la date du :<br>
                <span class="sub-alt-header fg-dark"> {{ model.date_realisation|date:"d/m/Y" }} </span>
            </p>
        </div>
        {% endif %}
        <div class="row cells2">
            <div class="cell">
                <p class="minor-header fg-gray">
                    Numéro du bon d'achat :<br> {% if model.numero != None and model.numero != "" %}
                    <span class="sub-alt-header fg-dark">{{ model.numero }}</span> {% else %}
                    <span class="sub-alt-header fg-dark">-</span> {% endif %}
                </p>
            </div>
            <div class="cell">
                <p class="minor-header fg-gray">
                    Date prévue :<br> {% if model.date_prevue != None and model.date_prevue != "" %}
                    <span class="sub-alt-header fg-dark">{{ model.date_prevue|date:"d/m/Y" }}</span> {% else %}
                    <span class="sub-alt-header fg-dark">-</span> {% endif %}
                </p>
            </div>
        </div>
        <div class="row cells2">
            <div class="cell">
                <p class="minor-header fg-gray">
                    Fournisseur :<br>
                    <a class="sub-alt-header lien chargement-au-click" href="{% url 'module_achat_details_fournisseur' model.fournisseur.id %}"> {{ model.fournisseur.nom_complet }} </a>
                </p>
            </div>
            <div class="cell">
                <p class="minor-header fg-gray">
                    Modalité de réglèment :<br>
                    <span class="sub-alt-header fg-dark"> {{ model.condition_reglement.designation }} </span>
                </p>
            </div>
        </div>
        <div class="row cells2">
            <div class="cell">
                <p class="minor-header fg-gray">
                    Dévise :<br>
                    <span class="sub-alt-header fg-dark"> {{ model.devise.designation }} </span>
                </p>
            </div>
            <div class="cell">
                <p class="minor-header fg-gray">
                    Référence du document :<br> {% if model.reference_document != None and model.reference_document != "" %}
                    <span class="sub-alt-header fg-dark">{{ model.reference_document }}</span> {% else %}
                    <span class="sub-alt-header fg-dark">-</span> {% endif %}
                </p>
            </div>
        </div>
        <div class="row cells2">
            <div class="cell">
                <p class="minor-header fg-gray">
                    Agent receveur :<br>
                    <span class="sub-alt-header fg-dark"> {{ model.receveur.nom_complet }} </span>
                </p>
            </div>
        </div>
        <div class="row">
            <table class="table border bordered">
                <thead>
                    <tr>
                        <th width="25%">Article</th>
                        <th width="18%">Quantité demandée</th>
                        <th width="18%">Quantité fournie</th>
                        <th width="19%">Prix unitaire</th>
                        <th width="20%">Prix total</th>
                    </tr>
                </thead>
                <tbody>
                    {% for ligne in lignes %}
                    <tr class="table bordered border">
                        <td>{{ ligne.nom_article}}</td>
                        <td>{{ ligne.quantite_demandee }} {{ ligne.unite.symbole_unite }}</td>
                        <td>{{ ligne.quantite_fournie }} {{ ligne.unite.symbole_unite }}</td>
                        <td>{{ ligne.prix_unitaire|intcomma }} {{ model.devise.symbole_devise }}</td>
                        <td>{{ ligne.total|intcomma }} {{ model.devise.symbole_devise }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
                <tfoot>
                    <tr>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td style="border:1px #999999 solid">TOTAL</td>
                        <td style="border:1px #999999 solid">{{ model.prix_total|intcomma }} {{ model.devise.symbole_devise }}</td>
                    </tr>
                </tfoot>
            </table>
        </div>
    </div>
</div>
<script src="/static/ErpProject/js/fourniture-local.js"></script>
<script>
    $(document).ready(function() {
        fournitureLocal.supprimerFourniture();
        fournitureLocal.supprimerToutesLignes();
    });

    function imprimer() {
        var mywindow = window.open('', 'Print', 'width=800');
        var ticket = document.getElementById("content_bon").innerHTML;
        mywindow.document = document;
        mywindow.document.body.innerHTML = ticket;

        mywindow.document.close();
        mywindow.focus()
        mywindow.print();
        mywindow.close();
        return true;
    }
</script>
{% endblock %}